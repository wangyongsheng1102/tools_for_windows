

è¿™ä¸ªé—®é¢˜å¯ä»¥ä¸€æ¬¡æ€§æŠŠæ—¥å¿—ä½“ç³»æ­å¥½ï¼Œåé¢æ’é”™ä¸å®¡è®¡éƒ½ä¼šçœå¾ˆå¤šæ—¶é—´ã€‚ä¸‹é¢ç»™ä½ ä¸€å¥—å·¥ç¨‹çº§å¯ç”¨çš„ FastAPI æ—¥å¿—æ–¹æ¡ˆï¼ŒåŒ…å«æ§åˆ¶å°ã€æ–‡ä»¶ã€æŒ‰æ—¥æœŸæ»šåŠ¨ã€ç»Ÿä¸€æ ¼å¼ï¼Œä»¥åŠä¸ uvicorn æ—¥å¿—ä¸å†²çªçš„åšæ³•ã€‚

â¸»

ä¸€ã€ç¬¬ä¸€æ€§åŸç†ï¼šFastAPI æ—¥å¿—æœ¬è´¨æ˜¯ä»€ä¹ˆ

FastAPI æœ¬èº«ä¸æä¾›æ—¥å¿—ç³»ç»Ÿï¼Œå®ƒå®Œå…¨ä¾èµ–ï¼š
	â€¢	Python æ ‡å‡†åº“ logging
	â€¢	uvicorn è‡ªå¸¦çš„ access log ä¸ error log

æ‰€ä»¥ç›®æ ‡åªæœ‰ä¸‰ä¸ªï¼š
	1.	ä¸šåŠ¡ä»£ç ç»Ÿä¸€ç”¨åŒä¸€ä¸ª logger
	2.	æ—¥å¿—åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°å’Œæ–‡ä»¶
	3.	ä¸è¢« uvicorn çš„é»˜è®¤é…ç½®è¦†ç›–

â¸»

äºŒã€æ¨èå·¥ç¨‹ç»“æ„

åœ¨ backend æ ¹ç›®å½•å¢åŠ ï¼š

backend/
 â”œâ”€ app/
 â”‚   â”œâ”€ main.py
 â”‚   â”œâ”€ core/
 â”‚   â”‚   â””â”€ logger.py
 â”‚   â””â”€ api/...
 â””â”€ logs/

logs ç›®å½•ç”¨äºå­˜æ”¾æ—¥å¿—æ–‡ä»¶ã€‚

â¸»

ä¸‰ã€æ—¥å¿—é…ç½®å®ç°

app/core/logger.py

import logging
from logging.handlers import TimedRotatingFileHandler
from pathlib import Path

LOG_DIR = Path(__file__).resolve().parent.parent.parent / "logs"
LOG_DIR.mkdir(exist_ok=True)

LOG_FILE = LOG_DIR / "app.log"


def setup_logging():
    formatter = logging.Formatter(
        "[%(asctime)s] [%(levelname)s] [%(name)s] %(message)s"
    )

    file_handler = TimedRotatingFileHandler(
        LOG_FILE,
        when="midnight",
        interval=1,
        backupCount=14,
        encoding="utf-8",
    )
    file_handler.setFormatter(formatter)
    file_handler.setLevel(logging.INFO)

    console_handler = logging.StreamHandler()
    console_handler.setFormatter(formatter)
    console_handler.setLevel(logging.INFO)

    root_logger = logging.getLogger()
    root_logger.setLevel(logging.INFO)
    root_logger.handlers.clear()
    root_logger.addHandler(file_handler)
    root_logger.addHandler(console_handler)

    # é˜²æ­¢ uvicorn è¦†ç›–
    logging.getLogger("uvicorn").propagate = True
    logging.getLogger("uvicorn.error").propagate = True
    logging.getLogger("uvicorn.access").propagate = False


â¸»

å››ã€åœ¨ FastAPI å¯åŠ¨æ—¶åŠ è½½æ—¥å¿—

app/main.py

from fastapi import FastAPI
from app.core.logger import setup_logging
import logging

setup_logging()

logger = logging.getLogger(__name__)

app = FastAPI()


@app.on_event("startup")
async def startup():
    logger.info("FastAPI application started")


@app.get("/health")
def health():
    logger.info("health check called")
    return {"status": "ok"}

æ­¤æ—¶ï¼š
	â€¢	æ§åˆ¶å°èƒ½çœ‹åˆ°æ—¥å¿—
	â€¢	logs/app.log ä¼šæŒç»­å†™å…¥
	â€¢	æ¯å¤©è‡ªåŠ¨åˆ‡åˆ†ä¸€ä¸ªæ–‡ä»¶

â¸»

äº”ã€åœ¨ä»»æ„æ¨¡å—ä¸­ä½¿ç”¨æ—¥å¿—

ä»»ä½•åœ°æ–¹ç»Ÿä¸€å†™æ³•ï¼š

import logging

logger = logging.getLogger(__name__)

logger.info("user login success")
logger.warning("token expired")
logger.error("db connection failed", exc_info=True)

__name__ ä¼šè‡ªåŠ¨å¸¦æ¨¡å—è·¯å¾„ï¼Œæ–¹ä¾¿å®šä½æ¥æºã€‚

â¸»

å…­ã€è®°å½•è¯·æ±‚çº§æ—¥å¿—ï¼ˆä¸­é—´ä»¶ï¼‰

å¦‚æœä½ æƒ³è®°å½•æ¯ä¸ªè¯·æ±‚çš„è€—æ—¶ä¸çŠ¶æ€ç ï¼š

import time
import logging
from fastapi import Request

logger = logging.getLogger("request")


@app.middleware("http")
async def log_requests(request: Request, call_next):
    start = time.time()
    response = await call_next(request)
    cost = (time.time() - start) * 1000

    logger.info(
        "%s %s %s %.2fms",
        request.method,
        request.url.path,
        response.status_code,
        cost,
    )
    return response

é€‚åˆç”Ÿäº§ç¯å¢ƒå®¡è®¡ä¸æ€§èƒ½åˆ†æã€‚

â¸»

ä¸ƒã€ä¸ uvicorn å¯åŠ¨æ–¹å¼çš„å…³ç³»

æ¨èå¯åŠ¨æ–¹å¼

uvicorn app.main:app --host 0.0.0.0 --port 8000

ä¸è¦å†åŠ ï¼š

--log-config

å¦åˆ™ä¼šè¦†ç›–ä½ è‡ªå·±çš„ logging é…ç½®ã€‚

å¦‚æœä½ ç”¨ reload

uvicorn app.main:app --reload

å­è¿›ç¨‹ä¹Ÿä¼šåŠ è½½åŒä¸€å¥—æ—¥å¿—é…ç½®ï¼Œè¡Œä¸ºæ­£å¸¸ã€‚

â¸»

å…«ã€å¸¸è§é”™è¯¯ä¸å®šä½

é—®é¢˜ 1ï¼šæ—¥å¿—æ–‡ä»¶ä¸ç”Ÿæˆ

åŸå› é€šå¸¸æ˜¯ï¼š
	â€¢	logs ç›®å½•æ— æƒé™
	â€¢	ç›¸å¯¹è·¯å¾„é”™äº†

ç¡®è®¤ï¼š

ls backend/logs

å¹¶æ£€æŸ¥ LOG_DIR å®é™…è·¯å¾„ã€‚

â¸»

é—®é¢˜ 2ï¼šåªçœ‹åˆ° uvicorn æ—¥å¿—ï¼Œçœ‹ä¸åˆ°ä¸šåŠ¡æ—¥å¿—

é€šå¸¸æ˜¯ï¼š
	â€¢	setup_logging æ²¡åœ¨ import æ—©æœŸæ‰§è¡Œ
	â€¢	root logger è¢«è¦†ç›–

å¿…é¡»ä¿è¯ï¼š

setup_logging()

åœ¨ FastAPI å®ä¾‹åˆ›å»ºä¹‹å‰æ‰§è¡Œã€‚

â¸»

ä¹ã€ä¼˜åŠ£åŠ¿ä¸é€‚ç”¨æ€§è¯„ä¼°

ä¼˜åŠ¿
	â€¢	å®Œå…¨æ ‡å‡† logging æ–¹æ¡ˆ
	â€¢	ä¸ä¾èµ–ç¬¬ä¸‰æ–¹åº“
	â€¢	å¯ç›´æ¥å¯¹æ¥ ELKã€Filebeat

é£é™©ä¸é™åˆ¶
	â€¢	å¤šè¿›ç¨‹éƒ¨ç½²æ—¶éœ€æ³¨æ„æ–‡ä»¶ç«äº‰
	â€¢	ä¸æ”¯æŒç»“æ„åŒ–æ—¥å¿—ï¼ˆJSONï¼‰
	â€¢	æ— é“¾è·¯è¿½è¸ªèƒ½åŠ›

ç½®ä¿¡åº¦è¯„çº§ï¼šé«˜ï¼Œé€‚ç”¨äºç»å¤§å¤šæ•°ä¸­å°å‹ FastAPI æœåŠ¡ã€‚

â¸»

ç»“è®º

FastAPI çš„æ—¥å¿—åº”åŸºäº Python loggingï¼Œåœ¨åº”ç”¨å¯åŠ¨é˜¶æ®µç»Ÿä¸€é…ç½® root loggerï¼Œç„¶åæ‰€æœ‰æ¨¡å—æŒ‰ logging.getLogger(__name__) ä½¿ç”¨ã€‚
è¯¥æ–¹å¼ç¨³å®šã€å¯ç»´æŠ¤ã€ä¸ uvicorn ä¸å†²çªï¼Œç”Ÿäº§ç¯å¢ƒå¯ç›´æ¥ä½¿ç”¨ã€‚

å¦‚æœä½ åé¢è¦ä¸Šå®¹å™¨æˆ–äº‘æ—¥å¿—ç³»ç»Ÿï¼Œæˆ‘å¯ä»¥å†ç»™ä½ ä¸€å¥— JSON ç»“æ„åŒ–æ—¥å¿—ç‰ˆæœ¬ï¼Œæ–¹ä¾¿ç›´æ¥æ¥å…¥æ—¥å¿—å¹³å°ã€‚



æ˜ç™½ï¼Œè¿™é‡Œç»™ä½ ä¸€å¥—å¯ç›´æ¥æ‰§è¡Œçš„ PostgreSQL DDLï¼ŒåŒ…å«ï¼š
	â€¢	âœ… åˆ›å»º schema
	â€¢	âœ… æ‰€æœ‰è¡¨æ”¾å…¥æŒ‡å®š schema
	â€¢	âœ… å…¨å­—æ®µæ—¥æ–‡ COMMENT
	â€¢	âœ… å…±é€šå®¡è®¡å­—æ®µï¼ˆä½œæˆæ—¥ï¼æ›´æ–°æ—¥ï¼ä½œæˆè€…ï¼æ›´æ–°è€…ï¼‰
	â€¢	âœ… å¤–é”®ä¸ç´¢å¼•

ä¸‹é¢å‡è®¾ä¸šåŠ¡ schema åä¸ºï¼švts

â¸»

âœ… ä¸€ã€Schema åˆ›å»º

CREATE SCHEMA IF NOT EXISTS vts;
COMMENT ON SCHEMA vts IS 'VTS Configurator æ¥­å‹™ç”¨ã‚¹ã‚­ãƒ¼ãƒ';


â¸»

âœ… äºŒã€UUID æ‰©å±•

CREATE EXTENSION IF NOT EXISTS "uuid-ossp";


â¸»

âœ… ä¸‰ã€ç”¨æˆ·è¡¨

CREATE TABLE vts.users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    email VARCHAR(255) NOT NULL UNIQUE,
    name VARCHAR(100),
    password_hash VARCHAR(255) NOT NULL,
    role VARCHAR(50) DEFAULT 'user',

    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

COMMENT ON TABLE vts.users IS 'ã‚·ã‚¹ãƒ†ãƒ åˆ©ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼';

COMMENT ON COLUMN vts.users.id IS 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ID';
COMMENT ON COLUMN vts.users.email IS 'ãƒ­ã‚°ã‚¤ãƒ³ç”¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹';
COMMENT ON COLUMN vts.users.name IS 'è¡¨ç¤ºå';
COMMENT ON COLUMN vts.users.password_hash IS 'æš—å·åŒ–æ¸ˆã¿ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰';
COMMENT ON COLUMN vts.users.role IS 'æ¨©é™ç¨®åˆ¥ï¼ˆadmin / userï¼‰';
COMMENT ON COLUMN vts.users.created_at IS 'ä½œæˆæ—¥æ™‚';
COMMENT ON COLUMN vts.users.updated_at IS 'æ›´æ–°æ—¥æ™‚';

CREATE INDEX idx_users_email ON vts.users(email);


â¸»

âœ… å››ã€é¡¹ç›®è¡¨

CREATE TABLE vts.projects (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL,
    name VARCHAR(255) NOT NULL,
    status VARCHAR(50) DEFAULT 'editing',
    language VARCHAR(10) DEFAULT 'jp',
    last_total_ct DOUBLE PRECISION,

    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_by UUID,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_by UUID,

    CONSTRAINT fk_projects_user
        FOREIGN KEY (user_id) REFERENCES vts.users(id)
);

COMMENT ON TABLE vts.projects IS 'è¨­è¨ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ';

COMMENT ON COLUMN vts.projects.id IS 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID';
COMMENT ON COLUMN vts.projects.user_id IS 'æ‰€æœ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ID';
COMMENT ON COLUMN vts.projects.name IS 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåç§°';
COMMENT ON COLUMN vts.projects.status IS 'çŠ¶æ…‹ï¼ˆediting / lockedï¼‰';
COMMENT ON COLUMN vts.projects.language IS 'è¡¨ç¤ºè¨€èª';
COMMENT ON COLUMN vts.projects.last_total_ct IS 'æœ€æ–°ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³CT';
COMMENT ON COLUMN vts.projects.created_at IS 'ä½œæˆæ—¥æ™‚';
COMMENT ON COLUMN vts.projects.created_by IS 'ä½œæˆè€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ID';
COMMENT ON COLUMN vts.projects.updated_at IS 'æ›´æ–°æ—¥æ™‚';
COMMENT ON COLUMN vts.projects.updated_by IS 'æ›´æ–°è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ID';

CREATE INDEX idx_projects_user_id ON vts.projects(user_id);
CREATE UNIQUE INDEX uniq_projects_name_user ON vts.projects(user_id, name);


â¸»

âœ… äº”ã€STEP è®¾è®¡æ•°æ®

CREATE TABLE vts.project_data (
    project_id UUID PRIMARY KEY,

    step1_json JSONB,
    step2_json JSONB,
    step3_json JSONB,
    step4_json JSONB,
    step5_json JSONB,

    version INTEGER DEFAULT 1,

    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_by UUID,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_by UUID,

    CONSTRAINT fk_project_data_project
        FOREIGN KEY (project_id) REFERENCES vts.projects(id)
        ON DELETE CASCADE
);

COMMENT ON TABLE vts.project_data IS 'STEPåˆ¥è¨­è¨ˆãƒ‡ãƒ¼ã‚¿ï¼ˆJSONã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆï¼‰';

COMMENT ON COLUMN vts.project_data.project_id IS 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID';
COMMENT ON COLUMN vts.project_data.step1_json IS 'STEP1 åŸºæœ¬æ¡ä»¶';
COMMENT ON COLUMN vts.project_data.step2_json IS 'STEP2 ç”Ÿç”£æ¡ä»¶';
COMMENT ON COLUMN vts.project_data.step3_json IS 'STEP3 å·¥ç¨‹ãƒ•ãƒ­ãƒ¼æ§‹æˆ';
COMMENT ON COLUMN vts.project_data.step4_json IS 'STEP4 ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨­è¨ˆ';
COMMENT ON COLUMN vts.project_data.step5_json IS 'STEP5 é…ç·šãƒ»åˆ¶å¾¡è¨­è¨ˆ';
COMMENT ON COLUMN vts.project_data.version IS 'ãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ã‚¸ãƒ§ãƒ³';
COMMENT ON COLUMN vts.project_data.created_at IS 'ä½œæˆæ—¥æ™‚';
COMMENT ON COLUMN vts.project_data.created_by IS 'ä½œæˆè€…';
COMMENT ON COLUMN vts.project_data.updated_at IS 'æ›´æ–°æ—¥æ™‚';
COMMENT ON COLUMN vts.project_data.updated_by IS 'æ›´æ–°è€…';


â¸»

âœ… å…­ã€ä»¿çœŸå†å²

CREATE TABLE vts.simulation_history (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    project_id UUID NOT NULL,
    run_no INTEGER NOT NULL,
    input_snapshot JSONB,

    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_by UUID,

    CONSTRAINT fk_sim_history_project
        FOREIGN KEY (project_id) REFERENCES vts.projects(id)
        ON DELETE CASCADE
);

COMMENT ON TABLE vts.simulation_history IS 'ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œå±¥æ­´';

COMMENT ON COLUMN vts.simulation_history.id IS 'å±¥æ­´ID';
COMMENT ON COLUMN vts.simulation_history.project_id IS 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID';
COMMENT ON COLUMN vts.simulation_history.run_no IS 'å®Ÿè¡Œå›æ•°ç•ªå·';
COMMENT ON COLUMN vts.simulation_history.input_snapshot IS 'å®Ÿè¡Œæ™‚è¨­è¨ˆãƒ‡ãƒ¼ã‚¿ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ';
COMMENT ON COLUMN vts.simulation_history.created_at IS 'å®Ÿè¡Œæ—¥æ™‚';
COMMENT ON COLUMN vts.simulation_history.created_by IS 'å®Ÿè¡Œãƒ¦ãƒ¼ã‚¶ãƒ¼';

CREATE UNIQUE INDEX uniq_sim_run_no ON vts.simulation_history(project_id, run_no);
CREATE INDEX idx_sim_history_project ON vts.simulation_history(project_id);


â¸»

âœ… ä¸ƒã€ä»¿çœŸç»“æœ

CREATE TABLE vts.simulation_result (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    history_id UUID NOT NULL,

    total_ct DOUBLE PRECISION,
    throughput DOUBLE PRECISION,
    bottleneck_process VARCHAR(255),
    utilization_json JSONB,
    chart_json JSONB,

    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_sim_result_history
        FOREIGN KEY (history_id) REFERENCES vts.simulation_history(id)
        ON DELETE CASCADE
);

COMMENT ON TABLE vts.simulation_result IS 'ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœ';

COMMENT ON COLUMN vts.simulation_result.id IS 'çµæœID';
COMMENT ON COLUMN vts.simulation_result.history_id IS 'å®Ÿè¡Œå±¥æ­´ID';
COMMENT ON COLUMN vts.simulation_result.total_ct IS 'ç·ã‚µã‚¤ã‚¯ãƒ«ã‚¿ã‚¤ãƒ ';
COMMENT ON COLUMN vts.simulation_result.throughput IS 'ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ';
COMMENT ON COLUMN vts.simulation_result.bottleneck_process IS 'ãƒœãƒˆãƒ«ãƒãƒƒã‚¯å·¥ç¨‹ID';
COMMENT ON COLUMN vts.simulation_result.utilization_json IS 'ç¨¼åƒç‡è©³ç´°JSON';
COMMENT ON COLUMN vts.simulation_result.chart_json IS 'ã‚°ãƒ©ãƒ•è¡¨ç¤ºç”¨ãƒ‡ãƒ¼ã‚¿';
COMMENT ON COLUMN vts.simulation_result.created_at IS 'ç™»éŒ²æ—¥æ™‚';

CREATE INDEX idx_sim_result_history ON vts.simulation_result(history_id);


â¸»

âœ… å…«ã€BOM å¿«ç…§

CREATE TABLE vts.bom_snapshot (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    project_id UUID NOT NULL,

    source_step5_json JSONB,
    bom_json JSONB,

    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_by UUID,

    CONSTRAINT fk_bom_project
        FOREIGN KEY (project_id) REFERENCES vts.projects(id)
        ON DELETE CASCADE
);

COMMENT ON TABLE vts.bom_snapshot IS 'BOMãŠã‚ˆã³é…ç·šçµæœã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ';


â¸»

âœ… ä¹ã€å¯¼å‡ºæ–‡ä»¶

CREATE TABLE vts.export_file (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    project_id UUID NOT NULL,

    file_type VARCHAR(50),
    file_path VARCHAR(500),

    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_by UUID,

    CONSTRAINT fk_export_project
        FOREIGN KEY (project_id) REFERENCES vts.projects(id)
        ON DELETE CASCADE
);

COMMENT ON TABLE vts.export_file IS 'å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ï¼ˆPDF / CSVï¼‰';


â¸»

âœ… åã€Master Library

CREATE TABLE vts.master_process (
    id VARCHAR(50) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    category VARCHAR(100),
    default_param_json JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

COMMENT ON TABLE vts.master_process IS 'æ¨™æº–å·¥ç¨‹ãƒã‚¹ã‚¿';


â¸»


CREATE TABLE vts.master_module (
    id VARCHAR(50) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    size_x DOUBLE PRECISION,
    size_y DOUBLE PRECISION,
    size_z DOUBLE PRECISION,
    speed DOUBLE PRECISION,
    accel DOUBLE PRECISION,
    payload DOUBLE PRECISION,
    param_json JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

COMMENT ON TABLE vts.master_module IS 'æ¨™æº–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒã‚¹ã‚¿';


â¸»


CREATE TABLE vts.master_controller (
    id VARCHAR(50) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    io_count INTEGER,
    power VARCHAR(50),
    param_json JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

COMMENT ON TABLE vts.master_controller IS 'åˆ¶å¾¡æ©Ÿå™¨ãƒã‚¹ã‚¿';


â¸»


CREATE TABLE vts.master_cable (
    id VARCHAR(50) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    length DOUBLE PRECISION,
    param_json JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

COMMENT ON TABLE vts.master_cable IS 'ã‚±ãƒ¼ãƒ–ãƒ«éƒ¨æãƒã‚¹ã‚¿';


â¸»

âœ… åä¸€ã€ç”¨æˆ·è‡ªå®šä¹‰åº“

CREATE TABLE vts.user_library (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL,

    type VARCHAR(50),
    name VARCHAR(255),
    data_json JSONB,

    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_by UUID,

    CONSTRAINT fk_user_library_user
        FOREIGN KEY (user_id) REFERENCES vts.users(id)
        ON DELETE CASCADE
);

COMMENT ON TABLE vts.user_library IS 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼é…ç·šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ';


â¸»

âœ… åäºŒã€å…³äºå…±é€šå­—æ®µè®¾è®¡çš„å·¥ç¨‹è§£é‡Š

ä½ æå‡ºçš„è¿™ä¸ªç‚¹åœ¨å·¥ç¨‹ç³»ç»Ÿé‡Œéå¸¸é‡è¦ï¼š
	â€¢	created_by / updated_by
	â€¢	created_at / updated_at

ç”¨äºï¼š
	â€¢	é—®é¢˜è¿½è¸ª
	â€¢	å®¡è®¡æ—¥å¿—
	â€¢	å¤šäººåä½œ
	â€¢	ç®¡ç†å‘˜ä»£æ“ä½œ

å°¤å…¶åœ¨åˆ¶é€ ä¸šç³»ç»Ÿé‡Œæ˜¯å¼ºéœ€æ±‚ã€‚

â¸»

âœ… ä¸‹ä¸€æ­¥å»ºè®®

ç°åœ¨æ•°æ®åº“å±‚å·²ç»æ˜¯ä¼ä¸šçº§æ ‡å‡†ç»“æ„äº†ï¼Œæ¥ä¸‹æ¥æœ€åˆç†çš„é¡ºåºæ˜¯ï¼š

ğŸ‘‰ FastAPI ORM Model ä¸è¿™å¥—è¡¨ç»“æ„ä¸€ä¸€å¯¹åº”

ç„¶åç»§ç»­ï¼š
	â€¢	Project CRUD API
	â€¢	STEP JSON ä¿å­˜æ¥å£

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ä¸‹ä¸€æ­¥ç›´æ¥ç»™ä½ ï¼š
	â€¢	âœ… SQLAlchemy Model å…¨å¥—å®šä¹‰
	â€¢	âœ… Alembic è¿ç§»è„šæœ¬æ¨¡æ¿

ä½ è·Ÿæˆ‘è¯´æ¥ä¸‹æ¥æƒ³å…ˆæ‰“å“ªä¸€å±‚ï¼Œæˆ‘ç»§ç»­å¾€ä¸‹è¡¥ã€‚