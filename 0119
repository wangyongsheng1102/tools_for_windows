æ˜ç™½ï¼Œè¿™é‡Œç»™ä½ ä¸€å¥—å¯ç›´æ¥æ‰§è¡Œçš„ PostgreSQL DDLï¼ŒåŒ…å«ï¼š
	â€¢	âœ… åˆ›å»º schema
	â€¢	âœ… æ‰€æœ‰è¡¨æ”¾å…¥æŒ‡å®š schema
	â€¢	âœ… å…¨å­—æ®µæ—¥æ–‡ COMMENT
	â€¢	âœ… å…±é€šå®¡è®¡å­—æ®µï¼ˆä½œæˆæ—¥ï¼æ›´æ–°æ—¥ï¼ä½œæˆè€…ï¼æ›´æ–°è€…ï¼‰
	â€¢	âœ… å¤–é”®ä¸ç´¢å¼•

ä¸‹é¢å‡è®¾ä¸šåŠ¡ schema åä¸ºï¼švts

â¸»

âœ… ä¸€ã€Schema åˆ›å»º

CREATE SCHEMA IF NOT EXISTS vts;
COMMENT ON SCHEMA vts IS 'VTS Configurator æ¥­å‹™ç”¨ã‚¹ã‚­ãƒ¼ãƒ';


â¸»

âœ… äºŒã€UUID æ‰©å±•

CREATE EXTENSION IF NOT EXISTS "uuid-ossp";


â¸»

âœ… ä¸‰ã€ç”¨æˆ·è¡¨

CREATE TABLE vts.users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    email VARCHAR(255) NOT NULL UNIQUE,
    name VARCHAR(100),
    password_hash VARCHAR(255) NOT NULL,
    role VARCHAR(50) DEFAULT 'user',

    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

COMMENT ON TABLE vts.users IS 'ã‚·ã‚¹ãƒ†ãƒ åˆ©ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼';

COMMENT ON COLUMN vts.users.id IS 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ID';
COMMENT ON COLUMN vts.users.email IS 'ãƒ­ã‚°ã‚¤ãƒ³ç”¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹';
COMMENT ON COLUMN vts.users.name IS 'è¡¨ç¤ºå';
COMMENT ON COLUMN vts.users.password_hash IS 'æš—å·åŒ–æ¸ˆã¿ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰';
COMMENT ON COLUMN vts.users.role IS 'æ¨©é™ç¨®åˆ¥ï¼ˆadmin / userï¼‰';
COMMENT ON COLUMN vts.users.created_at IS 'ä½œæˆæ—¥æ™‚';
COMMENT ON COLUMN vts.users.updated_at IS 'æ›´æ–°æ—¥æ™‚';

CREATE INDEX idx_users_email ON vts.users(email);


â¸»

âœ… å››ã€é¡¹ç›®è¡¨

CREATE TABLE vts.projects (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL,
    name VARCHAR(255) NOT NULL,
    status VARCHAR(50) DEFAULT 'editing',
    language VARCHAR(10) DEFAULT 'jp',
    last_total_ct DOUBLE PRECISION,

    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_by UUID,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_by UUID,

    CONSTRAINT fk_projects_user
        FOREIGN KEY (user_id) REFERENCES vts.users(id)
);

COMMENT ON TABLE vts.projects IS 'è¨­è¨ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ';

COMMENT ON COLUMN vts.projects.id IS 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID';
COMMENT ON COLUMN vts.projects.user_id IS 'æ‰€æœ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ID';
COMMENT ON COLUMN vts.projects.name IS 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåç§°';
COMMENT ON COLUMN vts.projects.status IS 'çŠ¶æ…‹ï¼ˆediting / lockedï¼‰';
COMMENT ON COLUMN vts.projects.language IS 'è¡¨ç¤ºè¨€èª';
COMMENT ON COLUMN vts.projects.last_total_ct IS 'æœ€æ–°ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³CT';
COMMENT ON COLUMN vts.projects.created_at IS 'ä½œæˆæ—¥æ™‚';
COMMENT ON COLUMN vts.projects.created_by IS 'ä½œæˆè€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ID';
COMMENT ON COLUMN vts.projects.updated_at IS 'æ›´æ–°æ—¥æ™‚';
COMMENT ON COLUMN vts.projects.updated_by IS 'æ›´æ–°è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ID';

CREATE INDEX idx_projects_user_id ON vts.projects(user_id);
CREATE UNIQUE INDEX uniq_projects_name_user ON vts.projects(user_id, name);


â¸»

âœ… äº”ã€STEP è®¾è®¡æ•°æ®

CREATE TABLE vts.project_data (
    project_id UUID PRIMARY KEY,

    step1_json JSONB,
    step2_json JSONB,
    step3_json JSONB,
    step4_json JSONB,
    step5_json JSONB,

    version INTEGER DEFAULT 1,

    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_by UUID,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_by UUID,

    CONSTRAINT fk_project_data_project
        FOREIGN KEY (project_id) REFERENCES vts.projects(id)
        ON DELETE CASCADE
);

COMMENT ON TABLE vts.project_data IS 'STEPåˆ¥è¨­è¨ˆãƒ‡ãƒ¼ã‚¿ï¼ˆJSONã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆï¼‰';

COMMENT ON COLUMN vts.project_data.project_id IS 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID';
COMMENT ON COLUMN vts.project_data.step1_json IS 'STEP1 åŸºæœ¬æ¡ä»¶';
COMMENT ON COLUMN vts.project_data.step2_json IS 'STEP2 ç”Ÿç”£æ¡ä»¶';
COMMENT ON COLUMN vts.project_data.step3_json IS 'STEP3 å·¥ç¨‹ãƒ•ãƒ­ãƒ¼æ§‹æˆ';
COMMENT ON COLUMN vts.project_data.step4_json IS 'STEP4 ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨­è¨ˆ';
COMMENT ON COLUMN vts.project_data.step5_json IS 'STEP5 é…ç·šãƒ»åˆ¶å¾¡è¨­è¨ˆ';
COMMENT ON COLUMN vts.project_data.version IS 'ãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ã‚¸ãƒ§ãƒ³';
COMMENT ON COLUMN vts.project_data.created_at IS 'ä½œæˆæ—¥æ™‚';
COMMENT ON COLUMN vts.project_data.created_by IS 'ä½œæˆè€…';
COMMENT ON COLUMN vts.project_data.updated_at IS 'æ›´æ–°æ—¥æ™‚';
COMMENT ON COLUMN vts.project_data.updated_by IS 'æ›´æ–°è€…';


â¸»

âœ… å…­ã€ä»¿çœŸå†å²

CREATE TABLE vts.simulation_history (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    project_id UUID NOT NULL,
    run_no INTEGER NOT NULL,
    input_snapshot JSONB,

    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_by UUID,

    CONSTRAINT fk_sim_history_project
        FOREIGN KEY (project_id) REFERENCES vts.projects(id)
        ON DELETE CASCADE
);

COMMENT ON TABLE vts.simulation_history IS 'ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œå±¥æ­´';

COMMENT ON COLUMN vts.simulation_history.id IS 'å±¥æ­´ID';
COMMENT ON COLUMN vts.simulation_history.project_id IS 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID';
COMMENT ON COLUMN vts.simulation_history.run_no IS 'å®Ÿè¡Œå›æ•°ç•ªå·';
COMMENT ON COLUMN vts.simulation_history.input_snapshot IS 'å®Ÿè¡Œæ™‚è¨­è¨ˆãƒ‡ãƒ¼ã‚¿ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ';
COMMENT ON COLUMN vts.simulation_history.created_at IS 'å®Ÿè¡Œæ—¥æ™‚';
COMMENT ON COLUMN vts.simulation_history.created_by IS 'å®Ÿè¡Œãƒ¦ãƒ¼ã‚¶ãƒ¼';

CREATE UNIQUE INDEX uniq_sim_run_no ON vts.simulation_history(project_id, run_no);
CREATE INDEX idx_sim_history_project ON vts.simulation_history(project_id);


â¸»

âœ… ä¸ƒã€ä»¿çœŸç»“æœ

CREATE TABLE vts.simulation_result (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    history_id UUID NOT NULL,

    total_ct DOUBLE PRECISION,
    throughput DOUBLE PRECISION,
    bottleneck_process VARCHAR(255),
    utilization_json JSONB,
    chart_json JSONB,

    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_sim_result_history
        FOREIGN KEY (history_id) REFERENCES vts.simulation_history(id)
        ON DELETE CASCADE
);

COMMENT ON TABLE vts.simulation_result IS 'ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœ';

COMMENT ON COLUMN vts.simulation_result.id IS 'çµæœID';
COMMENT ON COLUMN vts.simulation_result.history_id IS 'å®Ÿè¡Œå±¥æ­´ID';
COMMENT ON COLUMN vts.simulation_result.total_ct IS 'ç·ã‚µã‚¤ã‚¯ãƒ«ã‚¿ã‚¤ãƒ ';
COMMENT ON COLUMN vts.simulation_result.throughput IS 'ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ';
COMMENT ON COLUMN vts.simulation_result.bottleneck_process IS 'ãƒœãƒˆãƒ«ãƒãƒƒã‚¯å·¥ç¨‹ID';
COMMENT ON COLUMN vts.simulation_result.utilization_json IS 'ç¨¼åƒç‡è©³ç´°JSON';
COMMENT ON COLUMN vts.simulation_result.chart_json IS 'ã‚°ãƒ©ãƒ•è¡¨ç¤ºç”¨ãƒ‡ãƒ¼ã‚¿';
COMMENT ON COLUMN vts.simulation_result.created_at IS 'ç™»éŒ²æ—¥æ™‚';

CREATE INDEX idx_sim_result_history ON vts.simulation_result(history_id);


â¸»

âœ… å…«ã€BOM å¿«ç…§

CREATE TABLE vts.bom_snapshot (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    project_id UUID NOT NULL,

    source_step5_json JSONB,
    bom_json JSONB,

    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_by UUID,

    CONSTRAINT fk_bom_project
        FOREIGN KEY (project_id) REFERENCES vts.projects(id)
        ON DELETE CASCADE
);

COMMENT ON TABLE vts.bom_snapshot IS 'BOMãŠã‚ˆã³é…ç·šçµæœã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ';


â¸»

âœ… ä¹ã€å¯¼å‡ºæ–‡ä»¶

CREATE TABLE vts.export_file (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    project_id UUID NOT NULL,

    file_type VARCHAR(50),
    file_path VARCHAR(500),

    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_by UUID,

    CONSTRAINT fk_export_project
        FOREIGN KEY (project_id) REFERENCES vts.projects(id)
        ON DELETE CASCADE
);

COMMENT ON TABLE vts.export_file IS 'å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ï¼ˆPDF / CSVï¼‰';


â¸»

âœ… åã€Master Library

CREATE TABLE vts.master_process (
    id VARCHAR(50) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    category VARCHAR(100),
    default_param_json JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

COMMENT ON TABLE vts.master_process IS 'æ¨™æº–å·¥ç¨‹ãƒã‚¹ã‚¿';


â¸»


CREATE TABLE vts.master_module (
    id VARCHAR(50) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    size_x DOUBLE PRECISION,
    size_y DOUBLE PRECISION,
    size_z DOUBLE PRECISION,
    speed DOUBLE PRECISION,
    accel DOUBLE PRECISION,
    payload DOUBLE PRECISION,
    param_json JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

COMMENT ON TABLE vts.master_module IS 'æ¨™æº–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒã‚¹ã‚¿';


â¸»


CREATE TABLE vts.master_controller (
    id VARCHAR(50) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    io_count INTEGER,
    power VARCHAR(50),
    param_json JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

COMMENT ON TABLE vts.master_controller IS 'åˆ¶å¾¡æ©Ÿå™¨ãƒã‚¹ã‚¿';


â¸»


CREATE TABLE vts.master_cable (
    id VARCHAR(50) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    length DOUBLE PRECISION,
    param_json JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

COMMENT ON TABLE vts.master_cable IS 'ã‚±ãƒ¼ãƒ–ãƒ«éƒ¨æãƒã‚¹ã‚¿';


â¸»

âœ… åä¸€ã€ç”¨æˆ·è‡ªå®šä¹‰åº“

CREATE TABLE vts.user_library (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL,

    type VARCHAR(50),
    name VARCHAR(255),
    data_json JSONB,

    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_by UUID,

    CONSTRAINT fk_user_library_user
        FOREIGN KEY (user_id) REFERENCES vts.users(id)
        ON DELETE CASCADE
);

COMMENT ON TABLE vts.user_library IS 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼é…ç·šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ';


â¸»

âœ… åäºŒã€å…³äºå…±é€šå­—æ®µè®¾è®¡çš„å·¥ç¨‹è§£é‡Š

ä½ æå‡ºçš„è¿™ä¸ªç‚¹åœ¨å·¥ç¨‹ç³»ç»Ÿé‡Œéå¸¸é‡è¦ï¼š
	â€¢	created_by / updated_by
	â€¢	created_at / updated_at

ç”¨äºï¼š
	â€¢	é—®é¢˜è¿½è¸ª
	â€¢	å®¡è®¡æ—¥å¿—
	â€¢	å¤šäººåä½œ
	â€¢	ç®¡ç†å‘˜ä»£æ“ä½œ

å°¤å…¶åœ¨åˆ¶é€ ä¸šç³»ç»Ÿé‡Œæ˜¯å¼ºéœ€æ±‚ã€‚

â¸»

âœ… ä¸‹ä¸€æ­¥å»ºè®®

ç°åœ¨æ•°æ®åº“å±‚å·²ç»æ˜¯ä¼ä¸šçº§æ ‡å‡†ç»“æ„äº†ï¼Œæ¥ä¸‹æ¥æœ€åˆç†çš„é¡ºåºæ˜¯ï¼š

ğŸ‘‰ FastAPI ORM Model ä¸è¿™å¥—è¡¨ç»“æ„ä¸€ä¸€å¯¹åº”

ç„¶åç»§ç»­ï¼š
	â€¢	Project CRUD API
	â€¢	STEP JSON ä¿å­˜æ¥å£

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ä¸‹ä¸€æ­¥ç›´æ¥ç»™ä½ ï¼š
	â€¢	âœ… SQLAlchemy Model å…¨å¥—å®šä¹‰
	â€¢	âœ… Alembic è¿ç§»è„šæœ¬æ¨¡æ¿

ä½ è·Ÿæˆ‘è¯´æ¥ä¸‹æ¥æƒ³å…ˆæ‰“å“ªä¸€å±‚ï¼Œæˆ‘ç»§ç»­å¾€ä¸‹è¡¥ã€‚