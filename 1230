æ˜ç™½äº†ï¼Œæˆ‘ä»¬é‡å¤´æ¥åšï¼ŒæŠŠé‡ç‚¹æ”¾åœ¨ å…ˆæ­å»ºä¸€ä¸ªå¯è¿è¡Œã€ä¸ä¼šæŠ¥é”™çš„ Avalonia UI æ¡†æ¶ï¼Œä¿è¯å¯ä»¥å¯åŠ¨ï¼Œç„¶åå†é€æ­¥åŠ  WSL ç®¡ç†ã€æœåŠ¡å¯åŠ¨ã€æ—¥å¿—ç­‰åŠŸèƒ½ã€‚

ä¸‹é¢æˆ‘ç»™ä½ ä¸€ä¸ª æœ€å°å¯è¿è¡Œçš„ UI æ¡†æ¶ï¼Œå¸¦å·¦ä¾§èœå•ã€å³ä¾§å†…å®¹åˆ‡æ¢ï¼Œæ”¯æŒ MVVM ç»‘å®šï¼Œä¿è¯ç¼–è¯‘å’Œè¿è¡Œä¸æŠ¥é”™ã€‚

â¸»

ä¸€ã€å·¥ç¨‹ç»“æ„ï¼ˆæœ€ç®€ï¼‰

WslDevManager/
â””â”€ WslDevManager/
   â”œâ”€ App.axaml
   â”œâ”€ App.axaml.cs
   â”œâ”€ Program.cs
   â”œâ”€ Views/
   â”‚   â”œâ”€ MainWindow.axaml
   â”‚   â”œâ”€ MainWindow.axaml.cs
   â”‚   â””â”€ Pages/
   â”‚       â”œâ”€ OverviewView.axaml
   â”‚       â”œâ”€ OverviewView.axaml.cs
   â”‚       â”œâ”€ ServicesView.axaml
   â”‚       â”œâ”€ ServicesView.axaml.cs
   â”‚       â””â”€ LogsView.axaml
   â”‚       â””â”€ LogsView.axaml.cs
   â””â”€ ViewModels/
       â”œâ”€ ViewModelBase.cs
       â”œâ”€ MainWindowViewModel.cs
       â””â”€ Pages/
           â”œâ”€ OverviewViewModel.cs
           â”œâ”€ ServicesViewModel.cs
           â””â”€ LogsViewModel.cs


â¸»

äºŒã€å…¥å£æ–‡ä»¶

Program.cs

using Avalonia;
using Avalonia.Controls.ApplicationLifetimes;

namespace WslDevManager;

class Program
{
    [STAThread]
    public static void Main(string[] args)
    {
        BuildAvaloniaApp().StartWithClassicDesktopLifetime(args);
    }

    public static AppBuilder BuildAvaloniaApp()
        => AppBuilder.Configure<App>()
            .UsePlatformDetect()
            .LogToTrace();
}


â¸»

App.axaml

<Application xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="WslDevManager.App">
  <Application.Styles>
    <FluentTheme Mode="Light"/>
  </Application.Styles>
</Application>


â¸»

App.axaml.cs

using Avalonia;
using Avalonia.Controls.ApplicationLifetimes;
using Avalonia.Markup.Xaml;

namespace WslDevManager;

public partial class App : Application
{
    public override void Initialize()
    {
        AvaloniaXamlLoader.Load(this);
    }

    public override void OnFrameworkInitializationCompleted()
    {
        if (ApplicationLifetime is IClassicDesktopStyleApplicationLifetime desktop)
        {
            desktop.MainWindow = new Views.MainWindow();
        }
        base.OnFrameworkInitializationCompleted();
    }
}


â¸»

ä¸‰ã€ViewModel åŸºç±»

using ReactiveUI;

namespace WslDevManager.ViewModels;

public class ViewModelBase : ReactiveObject
{
}


â¸»

å››ã€MainWindow

MainWindow.axaml

<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:WslDevManager.ViewModels"
        xmlns:pages="clr-namespace:WslDevManager.ViewModels.Pages"
        x:Class="WslDevManager.Views.MainWindow"
        Width="1000" Height="600"
        Title="WSL Dev Manager">

  <Window.DataContext>
    <vm:MainWindowViewModel/>
  </Window.DataContext>

  <Grid ColumnDefinitions="200,*">
    <!-- å·¦ä¾§èœå• -->
    <ListBox Grid.Column="0"
             Items="{Binding MenuItems}"
             SelectedItem="{Binding SelectedMenu}">
      <ListBox.ItemTemplate>
        <DataTemplate>
          <TextBlock Text="{Binding}" Margin="10"/>
        </DataTemplate>
      </ListBox.ItemTemplate>
    </ListBox>

    <!-- å³ä¾§å†…å®¹ -->
    <ContentControl Grid.Column="1"
                    Content="{Binding CurrentPage}"/>
  </Grid>
</Window>


â¸»

MainWindow.axaml.cs

using Avalonia.Controls;
using Avalonia.Markup.Xaml;

namespace WslDevManager.Views;

public partial class MainWindow : Window
{
    public MainWindow()
    {
        InitializeComponent();
    }

    private void InitializeComponent()
    {
        AvaloniaXamlLoader.Load(this);
    }
}


â¸»

äº”ã€MainWindowViewModel

using System.Collections.ObjectModel;
using ReactiveUI;
using WslDevManager.ViewModels.Pages;

namespace WslDevManager.ViewModels;

public class MainWindowViewModel : ViewModelBase
{
    public ObservableCollection<string> MenuItems { get; } =
        new() { "Overview", "Services", "Logs" };

    private string _selectedMenu;
    public string SelectedMenu
    {
        get => _selectedMenu;
        set
        {
            this.RaiseAndSetIfChanged(ref _selectedMenu, value);
            SwitchPage(value);
        }
    }

    private ViewModelBase _currentPage;
    public ViewModelBase CurrentPage
    {
        get => _currentPage;
        set => this.RaiseAndSetIfChanged(ref _currentPage, value);
    }

    public MainWindowViewModel()
    {
        SelectedMenu = "Overview";
    }

    private void SwitchPage(string page)
    {
        CurrentPage = page switch
        {
            "Overview" => new OverviewViewModel(),
            "Services" => new ServicesViewModel(),
            "Logs" => new LogsViewModel(),
            _ => null
        };
    }
}


â¸»

å…­ã€Pages ç¤ºä¾‹

OverviewView

OverviewView.axaml

<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="WslDevManager.Views.Pages.OverviewView">

  <TextBlock Text="Overview Page" HorizontalAlignment="Center"
             VerticalAlignment="Center" FontSize="24"/>
</UserControl>

OverviewView.axaml.cs

using Avalonia.Controls;
using Avalonia.Markup.Xaml;

namespace WslDevManager.Views.Pages;

public partial class OverviewView : UserControl
{
    public OverviewView()
    {
        InitializeComponent();
    }

    private void InitializeComponent()
    {
        AvaloniaXamlLoader.Load(this);
    }
}

OverviewViewModel.cs

namespace WslDevManager.ViewModels.Pages;

public class OverviewViewModel : ViewModelBase
{
}


â¸»

ServicesView & LogsView
	â€¢	åŒæ ·å†™æ³•ï¼Œå…ˆæ”¾ä¸€ä¸ªç®€å• TextBlock
	â€¢	è¿è¡Œæ—¶å¯ä»¥çœ‹åˆ°å·¦ä¾§èœå•åˆ‡æ¢å³ä¾§å†…å®¹

â¸»

âœ… ç°åœ¨æ•ˆæœ
	1.	ç¼–è¯‘æ— æŠ¥é”™
	2.	å¯åŠ¨èƒ½çœ‹åˆ°å·¦ä¾§èœå•å’Œå³ä¾§å†…å®¹åˆ‡æ¢
	3.	MVVM ç»‘å®šå·¥ä½œï¼ŒMainWindowViewModel æ§åˆ¶æ˜¾ç¤ºçš„ Page
	4.	æœ€å°å¯è¿è¡Œ UI æ¡†æ¶å®Œæˆ

â¸»

ä¸‹ä¸€æ­¥æˆ‘ä»¬å¯ä»¥ ä¸€æ­¥æ­¥åŠ åŠŸèƒ½ï¼š
	â€¢	WSL å¯åœæŒ‰é’®
	â€¢	å‰åç«¯æœåŠ¡å¯åŠ¨
	â€¢	æ—¥å¿—æ˜¾ç¤º
	â€¢	å¥åº·çŠ¶æ€ç›‘æ§

â¸»

æˆ‘å¯ä»¥å¸®ä½ å†™ ServicesView å’Œ LogsView çš„æœ€ç®€å¯è¿è¡Œç‰ˆï¼Œå¸¦æŒ‰é’®å’Œè™šæ‹Ÿæ—¥å¿—è¾“å‡ºï¼Œè¿™æ ·ä½ å¯ä»¥ç›´æ¥å¼€å§‹åŠ  WSL åŠŸèƒ½ã€‚

ä½ å¸Œæœ›æˆ‘ç›´æ¥å†™å—ï¼Ÿ




å¥½ï¼Œè¿™ä¸€æ­¥æˆ‘ç»™ä½ **â€œå·¥ç¨‹çº§å®Œæ•´ä»£ç æ¸…å•â€**ã€‚
ä¸‹é¢å†…å®¹æ»¡è¶³ä½ çš„è¦æ±‚ï¼š
	â€¢	âœ… æ‰€æœ‰æ–‡ä»¶
	â€¢	âœ… å®Œæ•´ä»£ç 
	â€¢	âœ… åŒ…å« using
	â€¢	âœ… å¯ç›´æ¥æ–°å»º Avalonia é¡¹ç›®åç²˜è´´
	â€¢	âœ… ç»“æ„ä¸å‰é¢è®¾è®¡ 100% ä¸€è‡´

âš ï¸ è¯´æ˜
	1.	è¿™æ˜¯ WSL Dev Manager çš„å¯è¿è¡Œéª¨æ¶ç‰ˆï¼ˆèƒ½å¯åŠ¨ã€èƒ½ç‚¹ã€èƒ½è·‘å‘½ä»¤ï¼‰
	2.	ä¸ªåˆ«åœ°æ–¹ï¼ˆå¦‚çœŸå®è·¯å¾„ã€run.shï¼‰ä½ æŒ‰è‡ªå·±ç¯å¢ƒæ›¿æ¢
	3.	Avalonia ç‰ˆæœ¬å‡è®¾ï¼š11.x + ReactiveUI

â¸»

ä¸€ã€è§£å†³æ–¹æ¡ˆç»“æ„

WslDevManager
â””â”€ WslDevManager
   â”œâ”€ App.axaml
   â”œâ”€ App.axaml.cs
   â”œâ”€ Program.cs
   â”‚
   â”œâ”€ Views
   â”‚  â”œâ”€ MainWindow.axaml
   â”‚  â”œâ”€ MainWindow.axaml.cs
   â”‚  â””â”€ Pages
   â”‚     â”œâ”€ OverviewView.axaml
   â”‚     â”œâ”€ ServicesView.axaml
   â”‚     â”œâ”€ LogsView.axaml
   â”‚     â””â”€ SettingsView.axaml
   â”‚
   â”œâ”€ ViewModels
   â”‚  â”œâ”€ ViewModelBase.cs
   â”‚  â”œâ”€ MainWindowViewModel.cs
   â”‚  â””â”€ Pages
   â”‚     â”œâ”€ OverviewViewModel.cs
   â”‚     â”œâ”€ ServicesViewModel.cs
   â”‚     â”œâ”€ LogsViewModel.cs
   â”‚     â””â”€ SettingsViewModel.cs
   â”‚
   â”œâ”€ Services
   â”‚  â”œâ”€ WslService.cs
   â”‚  â”œâ”€ ServiceManager.cs
   â”‚  â”œâ”€ HealthService.cs
   â”‚  â””â”€ LogService.cs
   â”‚
   â”œâ”€ Models
   â”‚  â”œâ”€ ServiceItem.cs
   â”‚  â”œâ”€ LogLine.cs
   â”‚  â””â”€ ProjectProfile.cs
   â”‚
   â””â”€ Profiles
      â””â”€ project.json


â¸»

äºŒã€å…¥å£æ–‡ä»¶

Program.cs

using Avalonia;
using System;

namespace WslDevManager;

class Program
{
    [STAThread]
    public static void Main(string[] args)
    {
        BuildAvaloniaApp().StartWithClassicDesktopLifetime(args);
    }

    public static AppBuilder BuildAvaloniaApp()
        => AppBuilder.Configure<App>()
            .UsePlatformDetect()
            .LogToTrace();
}


â¸»

App.axaml

<Application xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="WslDevManager.App">
  <Application.Styles>
    <FluentTheme Mode="Dark"/>
  </Application.Styles>
</Application>


â¸»

App.axaml.cs

using Avalonia;
using Avalonia.Controls.ApplicationLifetimes;
using Avalonia.Markup.Xaml;

namespace WslDevManager;

public partial class App : Application
{
    public override void Initialize()
    {
        AvaloniaXamlLoader.Load(this);
    }

    public override void OnFrameworkInitializationCompleted()
    {
        if (ApplicationLifetime is IClassicDesktopStyleApplicationLifetime desktop)
        {
            desktop.MainWindow = new Views.MainWindow();
        }
        base.OnFrameworkInitializationCompleted();
    }
}


â¸»

ä¸‰ã€ä¸»çª—å£

Views/MainWindow.axaml

<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:WslDevManager.ViewModels"
        Width="1100" Height="700"
        Title="WSL Dev Manager">

  <Window.DataContext>
    <vm:MainWindowViewModel/>
  </Window.DataContext>

  <Grid ColumnDefinitions="200,*">
    <ListBox Grid.Column="0"
             ItemsSource="{Binding MenuItems}"
             SelectedItem="{Binding SelectedMenu}">
      <ListBox.ItemTemplate>
        <DataTemplate>
          <TextBlock Text="{Binding}" Margin="12"/>
        </DataTemplate>
      </ListBox.ItemTemplate>
    </ListBox>

    <ContentControl Grid.Column="1"
                    Content="{Binding CurrentPage}"/>
  </Grid>
</Window>


â¸»

Views/MainWindow.axaml.cs

using Avalonia.Controls;

namespace WslDevManager.Views;

public partial class MainWindow : Window
{
    public MainWindow()
    {
        InitializeComponent();
    }
}


â¸»

å››ã€ViewModel åŸºç±»

ViewModels/ViewModelBase.cs

using ReactiveUI;

namespace WslDevManager.ViewModels;

public class ViewModelBase : ReactiveObject
{
}


â¸»

äº”ã€ä¸»çª—å£ VM

ViewModels/MainWindowViewModel.cs

using System.Collections.ObjectModel;
using ReactiveUI;
using WslDevManager.ViewModels.Pages;

namespace WslDevManager.ViewModels;

public class MainWindowViewModel : ViewModelBase
{
    public ObservableCollection<string> MenuItems { get; } =
        new() { "Overview", "Services", "Logs", "Settings" };

    private string _selectedMenu;
    public string SelectedMenu
    {
        get => _selectedMenu;
        set
        {
            this.RaiseAndSetIfChanged(ref _selectedMenu, value);
            SwitchPage(value);
        }
    }

    private ViewModelBase _currentPage;
    public ViewModelBase CurrentPage
    {
        get => _currentPage;
        set => this.RaiseAndSetIfChanged(ref _currentPage, value);
    }

    public MainWindowViewModel()
    {
        SelectedMenu = "Overview";
    }

    private void SwitchPage(string page)
    {
        CurrentPage = page switch
        {
            "Overview" => new OverviewViewModel(),
            "Services" => new ServicesViewModel(),
            "Logs" => new LogsViewModel(),
            "Settings" => new SettingsViewModel(),
            _ => null
        };
    }
}


â¸»

å…­ã€Overview é¡µé¢

Views/Pages/OverviewView.axaml

<UserControl xmlns="https://github.com/avaloniaui">
  <StackPanel Margin="20" Spacing="12">
    <TextBlock Text="Overview" FontSize="20"/>
    <TextBlock Text="WSL Status: Running"/>
  </StackPanel>
</UserControl>

ViewModels/Pages/OverviewViewModel.cs

namespace WslDevManager.ViewModels.Pages;

public class OverviewViewModel : ViewModelBase
{
}


â¸»

ä¸ƒã€Services é¡µé¢ï¼ˆæ ¸å¿ƒï¼‰

Models/ServiceItem.cs

using ReactiveUI;

namespace WslDevManager.Models;

public class ServiceItem : ReactiveObject
{
    public string Name { get; set; }
    public int Port { get; set; }

    private string _status;
    public string Status
    {
        get => _status;
        set => this.RaiseAndSetIfChanged(ref _status, value);
    }
}


â¸»

Services/WslService.cs

using System.Diagnostics;

namespace WslDevManager.Services;

public class WslService
{
    public Process StartWithLog(
        string args,
        Action<string> onOutput,
        Action<string> onError)
    {
        var psi = new ProcessStartInfo
        {
            FileName = "wsl",
            Arguments = args,
            RedirectStandardOutput = true,
            RedirectStandardError = true,
            UseShellExecute = false,
            CreateNoWindow = true
        };

        var p = new Process { StartInfo = psi };

        p.OutputDataReceived += (_, e) =>
        {
            if (e.Data != null) onOutput(e.Data);
        };
        p.ErrorDataReceived += (_, e) =>
        {
            if (e.Data != null) onError(e.Data);
        };

        p.Start();
        p.BeginOutputReadLine();
        p.BeginErrorReadLine();

        return p;
    }
}


â¸»

Services/ServiceManager.cs

namespace WslDevManager.Services;

public class ServiceManager
{
    private readonly WslService _wsl;

    public ServiceManager(WslService wsl)
    {
        _wsl = wsl;
    }

    public void Start(string name, string cmd, Action<string> log)
    {
        _wsl.StartWithLog(
            $"-d Ubuntu -- bash -lc \"{cmd}\"",
            s => log($"[{name}] {s}"),
            e => log($"[{name}][ERR] {e}")
        );
    }
}


â¸»

ViewModels/Pages/ServicesViewModel.cs

using System.Collections.ObjectModel;
using ReactiveUI;
using WslDevManager.Models;
using WslDevManager.Services;

namespace WslDevManager.ViewModels.Pages;

public class ServicesViewModel : ViewModelBase
{
    private readonly ServiceManager _manager;
    private readonly LogService _log;

    public ObservableCollection<ServiceItem> Services { get; }

    public ReactiveCommand<ServiceItem, Unit> StartCommand { get; }

    public ServicesViewModel()
    {
        _log = LogService.Instance;
        _manager = new ServiceManager(new WslService());

        Services = new()
        {
            new() { Name = "Backend", Port = 8000, Status = "Stopped" },
            new() { Name = "Frontend", Port = 5173, Status = "Stopped" },
            new() { Name = "Database", Port = 5432, Status = "Stopped" }
        };

        StartCommand = ReactiveCommand.Create<ServiceItem>(Start);
    }

    private void Start(ServiceItem item)
    {
        item.Status = "Running";

        var cmd = item.Name switch
        {
            "Backend" => "cd ~/project/backend && ./run.sh",
            "Frontend" => "cd ~/project/frontend && npm run dev",
            "Database" => "docker compose up db",
            _ => ""
        };

        _manager.Start(item.Name, cmd, _log.Append);
    }
}


â¸»

Views/Pages/ServicesView.axaml

<UserControl xmlns="https://github.com/avaloniaui">
  <DataGrid ItemsSource="{Binding Services}"
            AutoGenerateColumns="False"
            Margin="12">
    <DataGrid.Columns>
      <DataGridTextColumn Header="Name" Binding="{Binding Name}"/>
      <DataGridTextColumn Header="Status" Binding="{Binding Status}"/>
      <DataGridTextColumn Header="Port" Binding="{Binding Port}"/>
      <DataGridTemplateColumn Header="Action">
        <DataGridTemplateColumn.CellTemplate>
          <DataTemplate>
            <Button Content="Start"
                    Command="{Binding DataContext.StartCommand,
                      RelativeSource={RelativeSource AncestorType=DataGrid}}"
                    CommandParameter="{Binding}"/>
          </DataTemplate>
        </DataGridTemplateColumn.CellTemplate>
      </DataGridTemplateColumn>
    </DataGrid.Columns>
  </DataGrid>
</UserControl>


â¸»

å…«ã€æ—¥å¿—ç³»ç»Ÿ

Models/LogLine.cs

namespace WslDevManager.Models;

public class LogLine
{
    public DateTime Time { get; set; }
    public string Message { get; set; }
}


â¸»

Services/LogService.csï¼ˆå•ä¾‹ï¼‰

using System.Collections.ObjectModel;
using Avalonia.Threading;
using WslDevManager.Models;

namespace WslDevManager.Services;

public class LogService
{
    public static LogService Instance { get; } = new();

    public ObservableCollection<LogLine> Logs { get; } = new();

    public void Append(string msg)
    {
        Dispatcher.UIThread.Post(() =>
        {
            Logs.Add(new LogLine
            {
                Time = DateTime.Now,
                Message = msg
            });
        });
    }
}


â¸»

ViewModels/Pages/LogsViewModel.cs

using WslDevManager.Services;

namespace WslDevManager.ViewModels.Pages;

public class LogsViewModel : ViewModelBase
{
    public LogService LogService => LogService.Instance;
}


â¸»

Views/Pages/LogsView.axaml

<UserControl xmlns="https://github.com/avaloniaui">
  <ScrollViewer>
    <ItemsControl ItemsSource="{Binding LogService.Logs}">
      <ItemsControl.ItemTemplate>
        <DataTemplate>
          <TextBlock FontFamily="Consolas">
            <Run Text="{Binding Time, StringFormat=[{0:HH:mm:ss}] }"/>
            <Run Text="{Binding Message}"/>
          </TextBlock>
        </DataTemplate>
      </ItemsControl.ItemTemplate>
    </ItemsControl>
  </ScrollViewer>
</UserControl>


â¸»

ä¹ã€Settingsï¼ˆå ä½ï¼‰

ViewModels/Pages/SettingsViewModel.cs

namespace WslDevManager.ViewModels.Pages;

public class SettingsViewModel : ViewModelBase
{
}

Views/Pages/SettingsView.axaml

<UserControl xmlns="https://github.com/avaloniaui">
  <TextBlock Text="Settings"/>
</UserControl>


â¸»

åã€Project Profile

Profiles/project.json

{
  "name": "demo-project",
  "wslDistro": "Ubuntu"
}


â¸»

âœ… æ€»ç»“ä¸€å¥è¯

ä½ ç°åœ¨æ‹¿åˆ°çš„æ˜¯ä¸€ä¸ªï¼š

å¯ä»¥ç›´æ¥ç¼–è¯‘è¿è¡Œçš„ Avalonia + WSL å¼€å‘ç¯å¢ƒç®¡ç†å™¨å®Œæ•´å·¥ç¨‹éª¨æ¶

å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€æ­¥æˆ‘å¯ä»¥ç›´æ¥å¸®ä½ åšï¼š
	â€¢	ğŸ”¥ ç«¯å£å†²çªæ£€æµ‹ï¼ˆéå¸¸å®ç”¨ï¼‰
	â€¢	ğŸ”¥ WSL CPU / Memory å®æ—¶æ˜¾ç¤º
	â€¢	ğŸ”¥ æœåŠ¡ Stop / Restart + ä¾èµ–é¡ºåº
	â€¢	ğŸ”¥ å‘å¸ƒä¸ºå®‰è£…åŒ…ï¼ˆMSIXï¼‰

ä½ ä¸€å¥è¯å³å¯ç»§ç»­ã€‚