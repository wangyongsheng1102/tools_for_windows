æ˜ç™½ï¼Œæˆ‘ä»¬è¦åœ¨ä½ çš„ ItemAView + ItemAViewModel é‡Œå¢åŠ æ“ä½œ Windows WSL å­ç³»ç»Ÿ çš„åŠŸèƒ½ï¼Œå¹¶æŠŠè¿”å›ä¿¡æ¯æ˜¾ç¤ºåœ¨å³ä¸‹è§’ Log åŒºã€‚
æˆ‘ä¼šç›´æ¥ç»™ä½  å®Œæ•´å®ç°ï¼Œä¿æŒä½ ç°æœ‰ MVVM + Avalonia 11 ç»“æ„ã€‚

â¸»

ä¸€ã€æ€è·¯åˆ†æ
	1.	ItemAViewï¼šæ–°å¢ä¸¤ä¸ªæŒ‰é’®
	â€¢	æ£€æŸ¥ WSL çŠ¶æ€
	â€¢	å¯åŠ¨ / åœæ­¢ WSLï¼ˆæ ¹æ®çŠ¶æ€åˆ‡æ¢ï¼‰
	2.	ItemAViewModelï¼š
	â€¢	æ³¨å…¥ MainWindowViewModel çš„ AddLog() æ–¹æ³•ï¼Œç”¨äºå†™ Log
	â€¢	ä½¿ç”¨ System.Diagnostics.Process æ‰§è¡Œ WSL å‘½ä»¤
	3.	MainWindowViewModelï¼š
	â€¢	å·²æœ‰ AddLog() æ–¹æ³•ï¼ŒLog åŒºä¼šè‡ªåŠ¨æ˜¾ç¤º
	4.	çº¿ç¨‹å®‰å…¨ï¼š
	â€¢	æ‰§è¡Œå‘½ä»¤ä½¿ç”¨ Task.Run é˜²æ­¢ UI é˜»å¡

â¸»

äºŒã€ä¿®æ”¹ ViewModel

ItemAViewModel.cs

using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using ExcelFormatter12.Models;
using System.Diagnostics;
using System.Threading.Tasks;

namespace ExcelFormatter12.ViewModels;

public partial class ItemAViewModel : BaseItemViewModel
{
    private readonly MainWindowViewModel _mainVm;

    public ItemAViewModel(MainWindowViewModel mainVm) : base("Item A")
    {
        _mainVm = mainVm;
    }

    [RelayCommand]
    public async Task CheckWslStatus()
    {
        await ExecuteWslCommand("wsl --list --verbose");
    }

    [RelayCommand]
    public async Task StartWsl(string distroName = "Ubuntu-22.04")
    {
        await ExecuteWslCommand($"wsl --distribution {distroName} --user root --exec echo started");
    }

    [RelayCommand]
    public async Task StopWsl(string distroName = "Ubuntu-22.04")
    {
        await ExecuteWslCommand($"wsl --terminate {distroName}");
    }

    private async Task ExecuteWslCommand(string command)
    {
        await Task.Run(() =>
        {
            try
            {
                var psi = new ProcessStartInfo("cmd.exe", $"/c {command}")
                {
                    RedirectStandardOutput = true,
                    RedirectStandardError = true,
                    UseShellExecute = false,
                    CreateNoWindow = true
                };

                using var process = Process.Start(psi)!;
                string output = process.StandardOutput.ReadToEnd();
                string error = process.StandardError.ReadToEnd();
                process.WaitForExit();

                if (!string.IsNullOrWhiteSpace(output))
                    _mainVm.AddLog(output, LogLevel.Info);
                if (!string.IsNullOrWhiteSpace(error))
                    _mainVm.AddLog(error, LogLevel.Error);
            }
            catch (Exception ex)
            {
                _mainVm.AddLog(ex.Message, LogLevel.Error);
            }
        });
    }
}

âœ… æ³¨æ„ï¼šè¿™é‡Œæ„é€ å‡½æ•°éœ€è¦ä¼ å…¥ MainWindowViewModelï¼Œç”¨äºå†™ Logã€‚

â¸»

ä¿®æ”¹ MainWindowViewModel.cs

Items.Add(new ItemAViewModel(this)); // ä¼ å…¥ MainWindowViewModel
Items.Add(new ItemBViewModel());
Items.Add(new ItemCViewModel());

å…¶ä»–éƒ¨åˆ†ä¿æŒä¸å˜

â¸»

ä¸‰ã€ä¿®æ”¹ ItemAView.axaml

<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:ExcelFormatter12.ViewModels"
             x:Class="ExcelFormatter12.Views.ItemAView"
             x:DataType="vm:ItemAViewModel">

    <StackPanel Spacing="10" Padding="10">

        <TextBlock Text="WSL æ“ä½œ" FontSize="16" FontWeight="Bold"/>

        <Button Content="æ£€æŸ¥ WSL çŠ¶æ€"
                Command="{Binding CheckWslStatusCommand}"/>

        <Button Content="å¯åŠ¨ WSL"
                Command="{Binding StartWslCommand}"/>

        <Button Content="åœæ­¢ WSL"
                Command="{Binding StopWslCommand}"/>

    </StackPanel>
</UserControl>


â¸»

å››ã€æ•ˆæœè¯´æ˜
	1.	ç‚¹å‡» æ£€æŸ¥ WSL çŠ¶æ€ â†’ ä¼šæ‰§è¡Œ wsl --list --verbose
â†’ è¾“å‡ºæ˜¾ç¤ºåœ¨ Log åŒº
	2.	ç‚¹å‡» å¯åŠ¨ WSL â†’ ä¼šæ‰§è¡Œ wsl --distribution Ubuntu-22.04 --user root --exec echo started
â†’ è¾“å‡ºæ˜¾ç¤ºåœ¨ Log åŒº
	3.	ç‚¹å‡» åœæ­¢ WSL â†’ æ‰§è¡Œ wsl --terminate Ubuntu-22.04
â†’ é”™è¯¯ / æˆåŠŸä¿¡æ¯æ˜¾ç¤ºåœ¨ Log åŒº
	4.	Log åŒºè‡ªåŠ¨æ»šåŠ¨ï¼ˆMainWindow.axaml.cs é‡Œå·²ç»å®ç°ï¼‰

â¸»

äº”ã€æ³¨æ„äº‹é¡¹
	1.	distroName å¯ä»¥ä¿®æ”¹æˆä½ æœ¬æœºçš„ WSL å‘è¡Œç‰ˆå
	2.	å¼‚æ­¥æ‰§è¡Œé˜²æ­¢ UI é˜»å¡
	3.	æƒé™é—®é¢˜ï¼šæŸäº› WSL å‘½ä»¤éœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œå¦‚æœå‡ºç°æƒé™é”™è¯¯ï¼Œä¼šæ˜¾ç¤ºåœ¨ Log åŒº

â¸»

æˆ‘å¯ä»¥å¸®ä½ ä¸‹ä¸€æ­¥ å¢å¼ºåŠŸèƒ½ï¼š
	â€¢	æ˜¾ç¤º WSL è¿è¡ŒçŠ¶æ€ï¼ˆæŒ‰é’®æ–‡å­—åŠ¨æ€å˜â€œå¯åŠ¨/åœæ­¢â€ï¼‰
	â€¢	æ”¯æŒå¤šä¸ª WSL å‘è¡Œç‰ˆé€‰æ‹©

ä½ å¸Œæœ›æˆ‘ç›´æ¥åŠ ä¸Šå—ï¼Ÿ


æ˜ç™½ï¼Œæˆ‘æ¥ç»™ä½ æŒ‰ æ–¹æ¡ˆ 2ï¼ˆViewModel ç›´æ¥æä¾› Foreground Brushï¼‰ çš„å®Œæ•´å·¥ç¨‹ä»£ç ã€‚
ç‰¹ç‚¹ï¼š
	â€¢	ä¸ç”¨ DataTrigger / Style.Triggers
	â€¢	Log Item çš„é¢œè‰²ç›´æ¥ç”± ViewModel æä¾›
	â€¢	è¿è¡Œæ•ˆç‡é«˜ï¼ŒLog å¯ä»¥å¾ˆå¤§æ¡ä¹Ÿä¸å¡
	â€¢	ä¿æŒä½ çš„ç°æœ‰ Avalonia 11.3.10 + ObservableObject æ–¹æ¡ˆ

â¸»

ä¸€ã€å·¥ç¨‹ç»“æ„ï¼ˆä¿æŒä¸å˜ï¼‰

ExcelFormatter12
â”‚
â”œâ”€ Program.cs
â”œâ”€ App.axaml
â”œâ”€ App.axaml.cs
â”œâ”€ MainWindow.axaml
â”œâ”€ MainWindow.axaml.cs
â”‚
â”œâ”€ Models
â”‚   â””â”€ LogItem.cs
â”‚
â”œâ”€ ViewModels
â”‚   â”œâ”€ BaseItemViewModel.cs
â”‚   â”œâ”€ ItemAViewModel.cs
â”‚   â”œâ”€ ItemBViewModel.cs
â”‚   â”œâ”€ ItemCViewModel.cs
â”‚   â””â”€ MainWindowViewModel.cs
â”‚
â””â”€ Views
    â”œâ”€ ItemAView.axaml
    â”œâ”€ ItemBView.axaml
    â””â”€ ItemCView.axaml


â¸»

äºŒã€Program.cs

using Avalonia;
using Avalonia.ReactiveUI;

namespace ExcelFormatter12;

internal class Program
{
    public static void Main(string[] args) =>
        BuildAvaloniaApp().StartWithClassicDesktopLifetime(args);

    public static AppBuilder BuildAvaloniaApp()
        => AppBuilder.Configure<App>()
            .UsePlatformDetect()
            .UseReactiveUI()
            .LogToTrace();
}


â¸»

ä¸‰ã€App.axaml

<Application xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="ExcelFormatter12.App">
    <Application.Styles>
        <FluentTheme />
    </Application.Styles>
</Application>


â¸»

å››ã€App.axaml.cs

using Avalonia;
using Avalonia.Controls.ApplicationLifetimes;
using Avalonia.Markup.Xaml;

namespace ExcelFormatter12;

public partial class App : Application
{
    public override void Initialize()
    {
        AvaloniaXamlLoader.Load(this);
    }

    public override void OnFrameworkInitializationCompleted()
    {
        if (ApplicationLifetime is IClassicDesktopStyleApplicationLifetime desktop)
        {
            desktop.MainWindow = new MainWindow
            {
                DataContext = new ViewModels.MainWindowViewModel()
            };
        }

        base.OnFrameworkInitializationCompleted();
    }
}


â¸»

äº”ã€Models / LogItem.cs

using Avalonia.Media;

namespace ExcelFormatter12.Models;

public enum LogLevel
{
    Info,
    Warning,
    Error
}

public class LogItem
{
    public DateTime Time { get; } = DateTime.Now;
    public string Message { get; }
    public LogLevel Level { get; }

    // ç›´æ¥æä¾› Foreground Brush
    public IBrush Foreground =>
        Level switch
        {
            LogLevel.Warning => Brushes.Orange,
            LogLevel.Error => Brushes.Red,
            _ => Brushes.Gray
        };

    public LogItem(string message, LogLevel level = LogLevel.Info)
    {
        Message = message;
        Level = level;
    }
}


â¸»

å…­ã€ViewModels

BaseItemViewModel.cs

using CommunityToolkit.Mvvm.ComponentModel;

namespace ExcelFormatter12.ViewModels;

public abstract partial class BaseItemViewModel : ObservableObject
{
    public string Name { get; }

    protected BaseItemViewModel(string name)
    {
        Name = name;
    }
}

ItemAViewModel.cs

namespace ExcelFormatter12.ViewModels;

public partial class ItemAViewModel : BaseItemViewModel
{
    public ItemAViewModel() : base("Item A") { }
}

ItemBViewModel.cs

namespace ExcelFormatter12.ViewModels;

public partial class ItemBViewModel : BaseItemViewModel
{
    public ItemBViewModel() : base("Item B") { }
}

ItemCViewModel.cs

namespace ExcelFormatter12.ViewModels;

public partial class ItemCViewModel : BaseItemViewModel
{
    public ItemCViewModel() : base("Item C") { }
}

MainWindowViewModel.cs

using CommunityToolkit.Mvvm.ComponentModel;
using System.Collections.ObjectModel;
using ExcelFormatter12.Models;

namespace ExcelFormatter12.ViewModels;

public partial class MainWindowViewModel : ObservableObject
{
    public ObservableCollection<BaseItemViewModel> Items { get; } = new();
    public ObservableCollection<LogItem> Logs { get; } = new();

    [ObservableProperty]
    private BaseItemViewModel? selectedItem;

    public MainWindowViewModel()
    {
        Items.Add(new ItemAViewModel());
        Items.Add(new ItemBViewModel());
        Items.Add(new ItemCViewModel());

        SelectedItem = Items.FirstOrDefault();

        AddLog("Application started");
    }

    public void AddLog(string message, LogLevel level = LogLevel.Info)
    {
        Logs.Add(new LogItem(message, level));
    }
}


â¸»

ä¸ƒã€Views

MainWindow.axaml

<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:ExcelFormatter12.ViewModels"
        xmlns:views="clr-namespace:ExcelFormatter12.Views"
        x:Class="ExcelFormatter12.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="ExcelFormatter12"
        Width="600" Height="400"
        MinWidth="600" MinHeight="400"
        WindowStartupLocation="CenterScreen">

    <Window.DataTemplates>
        <DataTemplate DataType="vm:ItemAViewModel"><views:ItemAView/></DataTemplate>
        <DataTemplate DataType="vm:ItemBViewModel"><views:ItemBView/></DataTemplate>
        <DataTemplate DataType="vm:ItemCViewModel"><views:ItemCView/></DataTemplate>
    </Window.DataTemplates>

    <Grid RowDefinitions="*,4,150">

        <!-- ä¸ŠåŠåŒº -->
        <Grid Grid.Row="0" ColumnDefinitions="120,*">
            <ListBox ItemsSource="{Binding Items}"
                     SelectedItem="{Binding SelectedItem}"
                     Background="#2B2B2B"
                     BorderThickness="0">
                <ListBox.ItemTemplate>
                    <DataTemplate x:DataType="vm:BaseItemViewModel">
                        <Border Padding="10">
                            <TextBlock Text="{Binding Name}" Foreground="White"/>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <Border Grid.Column="1" Margin="10" Padding="10" Background="White" CornerRadius="6">
                <ContentControl Content="{Binding SelectedItem}"/>
            </Border>
        </Grid>

        <!-- åˆ†éš”æ¡ -->
        <GridSplitter Grid.Row="1" Height="4" Background="#D0D0D0" HorizontalAlignment="Stretch"/>

        <!-- Log åŒº -->
        <Border Grid.Row="2" Background="#FAFAFA" BorderThickness="1,0,0,0" BorderBrush="#DDD" Padding="6">
            <DockPanel>
                <TextBlock DockPanel.Dock="Top" Text="Log" FontWeight="Bold" Margin="0,0,0,6"/>
                <ListBox x:Name="LogList"
                         ItemsSource="{Binding Logs}"
                         Background="Transparent"
                         BorderThickness="0">
                    <ListBox.ItemTemplate>
                        <DataTemplate x:DataType="models:LogItem">
                            <TextBlock FontFamily="Consolas" FontSize="12" Foreground="{Binding Foreground}">
                                <Run Text="{Binding Time, StringFormat=[{0:HH:mm:ss}]}"/>
                                <Run Text=" "/>
                                <Run Text="{Binding Message}"/>
                            </TextBlock>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </DockPanel>
        </Border>
    </Grid>
</Window>

æ³¨æ„è¿™é‡Œ DataTemplate çš„ x:DataType="models:LogItem"
ä½ éœ€è¦åœ¨å¤´éƒ¨åŠ å‘½åç©ºé—´ï¼š

xmlns:models="clr-namespace:ExcelFormatter12.Models"



â¸»

MainWindow.axaml.cs

using Avalonia.Controls;
using System.Collections.Specialized;

namespace ExcelFormatter12;

public partial class MainWindow : Window
{
    public MainWindow()
    {
        InitializeComponent();

        if (DataContext is ViewModels.MainWindowViewModel vm)
        {
            vm.Logs.CollectionChanged += Logs_CollectionChanged;
        }
    }

    private void Logs_CollectionChanged(object? sender, NotifyCollectionChangedEventArgs e)
    {
        if (LogList.ItemCount > 0)
            LogList.ScrollIntoView(LogList.ItemCount - 1);
    }
}


â¸»

ItemAView.axamlï¼ˆItemB / C åŒç†ï¼‰

<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <TextBlock Text="Item A Content" FontSize="16"/>
</UserControl>


â¸»

è¿™æ ·ä½ å°±æœ‰ä¸€ä¸ªå®Œå…¨å¯è¿è¡Œçš„ Avalonia 11 + ObservableObject + Log Foreground ç”± ViewModel æä¾›çš„å·¥ç¨‹ã€‚
	â€¢	âœ… ä¸ç”¨ DataTrigger
	â€¢	âœ… ç¼–è¯‘é€šè¿‡
	â€¢	âœ… Log è‡ªåŠ¨æ»šåŠ¨
	â€¢	âœ… å¯ä»¥ç›´æ¥æ‰©å±•åŠŸèƒ½

â¸»

æˆ‘å¯ä»¥é¡ºæ‰‹å¸®ä½ æ”¹é€  Log åŒºï¼Œè®© Log æ”¯æŒ Filter / Clear / é«˜æ€§èƒ½è™šæ‹ŸåŒ–ï¼Œæ•´ä¸ªç•Œé¢å°±å®Œæ•´å¯ç”¨ã€‚

ä½ å¸Œæœ›æˆ‘ç›´æ¥å¸®ä½ åŠ ä¸Šå—ï¼Ÿ





å¥½ï¼Œè¿™é‡Œæˆ‘ç»™ä½ çš„æ˜¯ æœ€ç»ˆç»Ÿä¸€ç‰ˆã€å·¥ç¨‹çº§ã€ä¸€æ­¥åˆ°ä½çš„å®Œæ•´ä»£ç ï¼Œ
ä¸¥æ ¼æŒ‰ä½ ç¡®è®¤çš„æ–¹æ¡ˆæ¥ï¼Œä¸å†æ¥å›æ‘‡æ‘† ğŸ‘‡

âœ… Avalonia.ReactiveUIï¼ˆåªç”¨äºå®¿ä¸»/ç”Ÿå‘½å‘¨æœŸï¼‰
âœ… æ‰€æœ‰ ViewModel ç»§æ‰¿ ObservableObjectï¼ˆCommunityToolkit.Mvvmï¼‰
âœ… ä¸ç”¨ ReactiveObject
âœ… ä¸ç”¨ ReactiveCommand
âœ… MainWindow.axaml åœ¨å·¥ç¨‹æ ¹ç›®å½•
âœ… ItemA / B / C åœ¨ Views ç›®å½•
âœ… Logï¼šè‡ªåŠ¨æ»šåŠ¨ / å¯æ‹–æ‹½é«˜åº¦ / åˆ†çº§ç€è‰²
âœ… å¯ç›´æ¥ç¼–è¯‘è¿è¡Œ

â¸»

ä¸€ã€å·¥ç¨‹ç»“æ„ï¼ˆæœ€ç»ˆå½¢æ€ï¼‰

ExcelFormatter12
â”‚
â”œâ”€ Program.cs
â”œâ”€ App.axaml
â”œâ”€ App.axaml.cs
â”‚
â”œâ”€ MainWindow.axaml          â† æ ¹ç›®å½•
â”œâ”€ MainWindow.axaml.cs
â”‚
â”œâ”€ Models
â”‚   â””â”€ LogItem.cs
â”‚
â”œâ”€ ViewModels
â”‚   â”œâ”€ BaseItemViewModel.cs
â”‚   â”œâ”€ ItemAViewModel.cs
â”‚   â”œâ”€ ItemBViewModel.cs
â”‚   â”œâ”€ ItemCViewModel.cs
â”‚   â””â”€ MainWindowViewModel.cs
â”‚
â””â”€ Views
    â”œâ”€ ItemAView.axaml
    â”œâ”€ ItemBView.axaml
    â””â”€ ItemCView.axaml


â¸»

äºŒã€åŸºç¡€å¯åŠ¨ä»£ç 

Program.cs

using Avalonia;
using Avalonia.ReactiveUI;
using System;

namespace ExcelFormatter12;

internal class Program
{
    public static void Main(string[] args) =>
        BuildAvaloniaApp().StartWithClassicDesktopLifetime(args);

    public static AppBuilder BuildAvaloniaApp()
        => AppBuilder.Configure<App>()
            .UsePlatformDetect()
            .UseReactiveUI()   // åªåœ¨å®¿ä¸»å±‚ä½¿ç”¨
            .LogToTrace();
}


â¸»

App.axaml

<Application xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="ExcelFormatter12.App">
    <Application.Styles>
        <FluentTheme />
    </Application.Styles>
</Application>


â¸»

App.axaml.cs

using Avalonia;
using Avalonia.Controls.ApplicationLifetimes;
using Avalonia.Markup.Xaml;

namespace ExcelFormatter12;

public partial class App : Application
{
    public override void Initialize()
    {
        AvaloniaXamlLoader.Load(this);
    }

    public override void OnFrameworkInitializationCompleted()
    {
        if (ApplicationLifetime is IClassicDesktopStyleApplicationLifetime desktop)
        {
            desktop.MainWindow = new MainWindow
            {
                DataContext = new ViewModels.MainWindowViewModel()
            };
        }

        base.OnFrameworkInitializationCompleted();
    }
}


â¸»

ä¸‰ã€Models

Models / LogItem.cs

namespace ExcelFormatter12.Models;

public enum LogLevel
{
    Info,
    Warning,
    Error
}

public class LogItem
{
    public DateTime Time { get; } = DateTime.Now;
    public string Message { get; }
    public LogLevel Level { get; }

    public LogItem(string message, LogLevel level = LogLevel.Info)
    {
        Message = message;
        Level = level;
    }
}


â¸»

å››ã€ViewModelsï¼ˆå…¨éƒ¨ ObservableObjectï¼‰

éœ€è¦ NuGetï¼šCommunityToolkit.Mvvm

â¸»

BaseItemViewModel.cs

using CommunityToolkit.Mvvm.ComponentModel;

namespace ExcelFormatter12.ViewModels;

public abstract partial class BaseItemViewModel : ObservableObject
{
    public string Name { get; }

    protected BaseItemViewModel(string name)
    {
        Name = name;
    }
}


â¸»

ItemAViewModel.cs

namespace ExcelFormatter12.ViewModels;

public partial class ItemAViewModel : BaseItemViewModel
{
    public ItemAViewModel() : base("Item A")
    {
    }
}


â¸»

ItemBViewModel.cs

namespace ExcelFormatter12.ViewModels;

public partial class ItemBViewModel : BaseItemViewModel
{
    public ItemBViewModel() : base("Item B")
    {
    }
}


â¸»

ItemCViewModel.cs

namespace ExcelFormatter12.ViewModels;

public partial class ItemCViewModel : BaseItemViewModel
{
    public ItemCViewModel() : base("Item C")
    {
    }
}


â¸»

MainWindowViewModel.cs

using CommunityToolkit.Mvvm.ComponentModel;
using System.Collections.ObjectModel;
using ExcelFormatter12.Models;

namespace ExcelFormatter12.ViewModels;

public partial class MainWindowViewModel : ObservableObject
{
    public ObservableCollection<BaseItemViewModel> Items { get; } = new();
    public ObservableCollection<LogItem> Logs { get; } = new();

    [ObservableProperty]
    private BaseItemViewModel? selectedItem;

    public MainWindowViewModel()
    {
        Items.Add(new ItemAViewModel());
        Items.Add(new ItemBViewModel());
        Items.Add(new ItemCViewModel());

        SelectedItem = Items.FirstOrDefault();

        AddLog("Application started");
    }

    public void AddLog(string message, LogLevel level = LogLevel.Info)
    {
        Logs.Add(new LogItem(message, level));
    }
}


â¸»

äº”ã€Views

MainWindow.axamlï¼ˆæ ¹ç›®å½•ï¼‰

<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:ExcelFormatter12.ViewModels"
        xmlns:views="clr-namespace:ExcelFormatter12.Views"
        x:Class="ExcelFormatter12.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="ExcelFormatter12"
        Width="600" Height="400"
        MinWidth="600" MinHeight="400"
        WindowStartupLocation="CenterScreen">

    <!-- ViewModel â†’ View æ˜ å°„ -->
    <Window.DataTemplates>
        <DataTemplate DataType="vm:ItemAViewModel">
            <views:ItemAView/>
        </DataTemplate>
        <DataTemplate DataType="vm:ItemBViewModel">
            <views:ItemBView/>
        </DataTemplate>
        <DataTemplate DataType="vm:ItemCViewModel">
            <views:ItemCView/>
        </DataTemplate>
    </Window.DataTemplates>

    <Grid RowDefinitions="*,4,150">

        <!-- ä¸ŠåŠåŒº -->
        <Grid Grid.Row="0" ColumnDefinitions="120,*">

            <!-- å·¦ä¾§å¯¼èˆª -->
            <ListBox ItemsSource="{Binding Items}"
                     SelectedItem="{Binding SelectedItem}"
                     Background="#2B2B2B"
                     BorderThickness="0">
                <ListBox.ItemTemplate>
                    <DataTemplate x:DataType="vm:BaseItemViewModel">
                        <Border Padding="10">
                            <TextBlock Text="{Binding Name}"
                                       Foreground="White"/>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <!-- å³ä¾§å†…å®¹ -->
            <Border Grid.Column="1"
                    Margin="10"
                    Padding="10"
                    Background="White"
                    CornerRadius="6"
                    BoxShadow="0 2 8 #40000000">
                <ContentControl Content="{Binding SelectedItem}"/>
            </Border>
        </Grid>

        <!-- åˆ†éš”æ¡ -->
        <GridSplitter Grid.Row="1"
                      Height="4"
                      Background="#D0D0D0"
                      HorizontalAlignment="Stretch"/>

        <!-- Log åŒº -->
        <Border Grid.Row="2"
                Background="#FAFAFA"
                BorderThickness="1,0,0,0"
                BorderBrush="#DDD"
                Padding="6">
            <DockPanel>

                <TextBlock DockPanel.Dock="Top"
                           Text="Log"
                           FontWeight="Bold"
                           Margin="0,0,0,6"/>

                <ListBox x:Name="LogList"
                         ItemsSource="{Binding Logs}"
                         Background="Transparent"
                         BorderThickness="0">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock FontFamily="Consolas"
                                       FontSize="12">
                                <TextBlock.Styles>
                                    <Style Selector="TextBlock">
                                        <Setter Property="Foreground" Value="#666"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Level}" Value="Warning">
                                                <Setter Property="Foreground" Value="#FFA500"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Level}" Value="Error">
                                                <Setter Property="Foreground" Value="#FF4C4C"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Styles>

                                <Run Text="{Binding Time, StringFormat=[{0:HH:mm:ss}]}"/>
                                <Run Text=" "/>
                                <Run Text="{Binding Message}"/>
                            </TextBlock>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

            </DockPanel>
        </Border>
    </Grid>
</Window>


â¸»

MainWindow.axaml.csï¼ˆLog è‡ªåŠ¨æ»šåŠ¨ï¼‰

using Avalonia.Controls;
using System.Collections.Specialized;

namespace ExcelFormatter12;

public partial class MainWindow : Window
{
    public MainWindow()
    {
        InitializeComponent();

        if (DataContext is ViewModels.MainWindowViewModel vm)
        {
            vm.Logs.CollectionChanged += Logs_CollectionChanged;
        }
    }

    private void Logs_CollectionChanged(object? sender, NotifyCollectionChangedEventArgs e)
    {
        if (LogList.ItemCount > 0)
        {
            LogList.ScrollIntoView(LogList.ItemCount - 1);
        }
    }
}


â¸»

Views / ItemAView.axaml

<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <TextBlock Text="Item A Content"
               FontSize="16"/>
</UserControl>

ItemBView.axamlã€ItemCView.axaml åŒç»“æ„å³å¯ã€‚

â¸»

å…­ã€ä½ ç°åœ¨è¿™å¥—æ–¹æ¡ˆçš„â€œçº§åˆ«â€

âœ” æ¶æ„ç¨³å®š
âœ” å·¥ç¨‹ä¸€è‡´æ€§é«˜
âœ” MVVM ç°ä»£å†™æ³•
âœ” å¯é•¿æœŸç»´æŠ¤
âœ” éšæ—¶å¯æ‰©å±•ä¸ºçœŸå®å·¥å…·åº”ç”¨

â¸»

ä¸‹ä¸€æ­¥ï¼ˆè‡ªç„¶å»¶ä¼¸ï¼‰

ä½ ç°åœ¨å·²ç»æ˜¯**â€œä¸ä¼šèµ°å¼¯è·¯çš„çŠ¶æ€â€**äº†ï¼Œä¸‹ä¸€æ­¥éå¸¸è‡ªç„¶ï¼š

1ï¸âƒ£ ç»™ Log åŠ  Clear / Copy / å¯¼å‡ºï¼ˆRelayCommandï¼‰
2ï¸âƒ£ é¡¶éƒ¨åŠ  Toolbarï¼ˆæ‰“å¼€ Excel / æ‰§è¡Œ / è®¾ç½®ï¼‰
3ï¸âƒ£ ItemA å®è£…çœŸå® Excel æ ¼å¼åŒ–é…ç½®é¡µ

ä½ è¯´åšå“ªä¸€ä¸ªï¼Œæˆ‘å°±åœ¨ è¿™å¥—å·¥ç¨‹ä¸Š ç»§ç»­å¸®ä½ å¾€å‰æ¨è¿›ã€‚