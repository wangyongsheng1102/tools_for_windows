å¥½ï¼Œè¿™é‡Œæˆ‘ç»™ä½ çš„æ˜¯ æœ€ç»ˆç»Ÿä¸€ç‰ˆã€å·¥ç¨‹çº§ã€ä¸€æ­¥åˆ°ä½çš„å®Œæ•´ä»£ç ï¼Œ
ä¸¥æ ¼æŒ‰ä½ ç¡®è®¤çš„æ–¹æ¡ˆæ¥ï¼Œä¸å†æ¥å›æ‘‡æ‘† ğŸ‘‡

âœ… Avalonia.ReactiveUIï¼ˆåªç”¨äºå®¿ä¸»/ç”Ÿå‘½å‘¨æœŸï¼‰
âœ… æ‰€æœ‰ ViewModel ç»§æ‰¿ ObservableObjectï¼ˆCommunityToolkit.Mvvmï¼‰
âœ… ä¸ç”¨ ReactiveObject
âœ… ä¸ç”¨ ReactiveCommand
âœ… MainWindow.axaml åœ¨å·¥ç¨‹æ ¹ç›®å½•
âœ… ItemA / B / C åœ¨ Views ç›®å½•
âœ… Logï¼šè‡ªåŠ¨æ»šåŠ¨ / å¯æ‹–æ‹½é«˜åº¦ / åˆ†çº§ç€è‰²
âœ… å¯ç›´æ¥ç¼–è¯‘è¿è¡Œ

â¸»

ä¸€ã€å·¥ç¨‹ç»“æ„ï¼ˆæœ€ç»ˆå½¢æ€ï¼‰

ExcelFormatter12
â”‚
â”œâ”€ Program.cs
â”œâ”€ App.axaml
â”œâ”€ App.axaml.cs
â”‚
â”œâ”€ MainWindow.axaml          â† æ ¹ç›®å½•
â”œâ”€ MainWindow.axaml.cs
â”‚
â”œâ”€ Models
â”‚   â””â”€ LogItem.cs
â”‚
â”œâ”€ ViewModels
â”‚   â”œâ”€ BaseItemViewModel.cs
â”‚   â”œâ”€ ItemAViewModel.cs
â”‚   â”œâ”€ ItemBViewModel.cs
â”‚   â”œâ”€ ItemCViewModel.cs
â”‚   â””â”€ MainWindowViewModel.cs
â”‚
â””â”€ Views
    â”œâ”€ ItemAView.axaml
    â”œâ”€ ItemBView.axaml
    â””â”€ ItemCView.axaml


â¸»

äºŒã€åŸºç¡€å¯åŠ¨ä»£ç 

Program.cs

using Avalonia;
using Avalonia.ReactiveUI;
using System;

namespace ExcelFormatter12;

internal class Program
{
    public static void Main(string[] args) =>
        BuildAvaloniaApp().StartWithClassicDesktopLifetime(args);

    public static AppBuilder BuildAvaloniaApp()
        => AppBuilder.Configure<App>()
            .UsePlatformDetect()
            .UseReactiveUI()   // åªåœ¨å®¿ä¸»å±‚ä½¿ç”¨
            .LogToTrace();
}


â¸»

App.axaml

<Application xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="ExcelFormatter12.App">
    <Application.Styles>
        <FluentTheme />
    </Application.Styles>
</Application>


â¸»

App.axaml.cs

using Avalonia;
using Avalonia.Controls.ApplicationLifetimes;
using Avalonia.Markup.Xaml;

namespace ExcelFormatter12;

public partial class App : Application
{
    public override void Initialize()
    {
        AvaloniaXamlLoader.Load(this);
    }

    public override void OnFrameworkInitializationCompleted()
    {
        if (ApplicationLifetime is IClassicDesktopStyleApplicationLifetime desktop)
        {
            desktop.MainWindow = new MainWindow
            {
                DataContext = new ViewModels.MainWindowViewModel()
            };
        }

        base.OnFrameworkInitializationCompleted();
    }
}


â¸»

ä¸‰ã€Models

Models / LogItem.cs

namespace ExcelFormatter12.Models;

public enum LogLevel
{
    Info,
    Warning,
    Error
}

public class LogItem
{
    public DateTime Time { get; } = DateTime.Now;
    public string Message { get; }
    public LogLevel Level { get; }

    public LogItem(string message, LogLevel level = LogLevel.Info)
    {
        Message = message;
        Level = level;
    }
}


â¸»

å››ã€ViewModelsï¼ˆå…¨éƒ¨ ObservableObjectï¼‰

éœ€è¦ NuGetï¼šCommunityToolkit.Mvvm

â¸»

BaseItemViewModel.cs

using CommunityToolkit.Mvvm.ComponentModel;

namespace ExcelFormatter12.ViewModels;

public abstract partial class BaseItemViewModel : ObservableObject
{
    public string Name { get; }

    protected BaseItemViewModel(string name)
    {
        Name = name;
    }
}


â¸»

ItemAViewModel.cs

namespace ExcelFormatter12.ViewModels;

public partial class ItemAViewModel : BaseItemViewModel
{
    public ItemAViewModel() : base("Item A")
    {
    }
}


â¸»

ItemBViewModel.cs

namespace ExcelFormatter12.ViewModels;

public partial class ItemBViewModel : BaseItemViewModel
{
    public ItemBViewModel() : base("Item B")
    {
    }
}


â¸»

ItemCViewModel.cs

namespace ExcelFormatter12.ViewModels;

public partial class ItemCViewModel : BaseItemViewModel
{
    public ItemCViewModel() : base("Item C")
    {
    }
}


â¸»

MainWindowViewModel.cs

using CommunityToolkit.Mvvm.ComponentModel;
using System.Collections.ObjectModel;
using ExcelFormatter12.Models;

namespace ExcelFormatter12.ViewModels;

public partial class MainWindowViewModel : ObservableObject
{
    public ObservableCollection<BaseItemViewModel> Items { get; } = new();
    public ObservableCollection<LogItem> Logs { get; } = new();

    [ObservableProperty]
    private BaseItemViewModel? selectedItem;

    public MainWindowViewModel()
    {
        Items.Add(new ItemAViewModel());
        Items.Add(new ItemBViewModel());
        Items.Add(new ItemCViewModel());

        SelectedItem = Items.FirstOrDefault();

        AddLog("Application started");
    }

    public void AddLog(string message, LogLevel level = LogLevel.Info)
    {
        Logs.Add(new LogItem(message, level));
    }
}


â¸»

äº”ã€Views

MainWindow.axamlï¼ˆæ ¹ç›®å½•ï¼‰

<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:ExcelFormatter12.ViewModels"
        xmlns:views="clr-namespace:ExcelFormatter12.Views"
        x:Class="ExcelFormatter12.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="ExcelFormatter12"
        Width="600" Height="400"
        MinWidth="600" MinHeight="400"
        WindowStartupLocation="CenterScreen">

    <!-- ViewModel â†’ View æ˜ å°„ -->
    <Window.DataTemplates>
        <DataTemplate DataType="vm:ItemAViewModel">
            <views:ItemAView/>
        </DataTemplate>
        <DataTemplate DataType="vm:ItemBViewModel">
            <views:ItemBView/>
        </DataTemplate>
        <DataTemplate DataType="vm:ItemCViewModel">
            <views:ItemCView/>
        </DataTemplate>
    </Window.DataTemplates>

    <Grid RowDefinitions="*,4,150">

        <!-- ä¸ŠåŠåŒº -->
        <Grid Grid.Row="0" ColumnDefinitions="120,*">

            <!-- å·¦ä¾§å¯¼èˆª -->
            <ListBox ItemsSource="{Binding Items}"
                     SelectedItem="{Binding SelectedItem}"
                     Background="#2B2B2B"
                     BorderThickness="0">
                <ListBox.ItemTemplate>
                    <DataTemplate x:DataType="vm:BaseItemViewModel">
                        <Border Padding="10">
                            <TextBlock Text="{Binding Name}"
                                       Foreground="White"/>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <!-- å³ä¾§å†…å®¹ -->
            <Border Grid.Column="1"
                    Margin="10"
                    Padding="10"
                    Background="White"
                    CornerRadius="6"
                    BoxShadow="0 2 8 #40000000">
                <ContentControl Content="{Binding SelectedItem}"/>
            </Border>
        </Grid>

        <!-- åˆ†éš”æ¡ -->
        <GridSplitter Grid.Row="1"
                      Height="4"
                      Background="#D0D0D0"
                      HorizontalAlignment="Stretch"/>

        <!-- Log åŒº -->
        <Border Grid.Row="2"
                Background="#FAFAFA"
                BorderThickness="1,0,0,0"
                BorderBrush="#DDD"
                Padding="6">
            <DockPanel>

                <TextBlock DockPanel.Dock="Top"
                           Text="Log"
                           FontWeight="Bold"
                           Margin="0,0,0,6"/>

                <ListBox x:Name="LogList"
                         ItemsSource="{Binding Logs}"
                         Background="Transparent"
                         BorderThickness="0">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock FontFamily="Consolas"
                                       FontSize="12">
                                <TextBlock.Styles>
                                    <Style Selector="TextBlock">
                                        <Setter Property="Foreground" Value="#666"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Level}" Value="Warning">
                                                <Setter Property="Foreground" Value="#FFA500"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Level}" Value="Error">
                                                <Setter Property="Foreground" Value="#FF4C4C"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Styles>

                                <Run Text="{Binding Time, StringFormat=[{0:HH:mm:ss}]}"/>
                                <Run Text=" "/>
                                <Run Text="{Binding Message}"/>
                            </TextBlock>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

            </DockPanel>
        </Border>
    </Grid>
</Window>


â¸»

MainWindow.axaml.csï¼ˆLog è‡ªåŠ¨æ»šåŠ¨ï¼‰

using Avalonia.Controls;
using System.Collections.Specialized;

namespace ExcelFormatter12;

public partial class MainWindow : Window
{
    public MainWindow()
    {
        InitializeComponent();

        if (DataContext is ViewModels.MainWindowViewModel vm)
        {
            vm.Logs.CollectionChanged += Logs_CollectionChanged;
        }
    }

    private void Logs_CollectionChanged(object? sender, NotifyCollectionChangedEventArgs e)
    {
        if (LogList.ItemCount > 0)
        {
            LogList.ScrollIntoView(LogList.ItemCount - 1);
        }
    }
}


â¸»

Views / ItemAView.axaml

<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <TextBlock Text="Item A Content"
               FontSize="16"/>
</UserControl>

ItemBView.axamlã€ItemCView.axaml åŒç»“æ„å³å¯ã€‚

â¸»

å…­ã€ä½ ç°åœ¨è¿™å¥—æ–¹æ¡ˆçš„â€œçº§åˆ«â€

âœ” æ¶æ„ç¨³å®š
âœ” å·¥ç¨‹ä¸€è‡´æ€§é«˜
âœ” MVVM ç°ä»£å†™æ³•
âœ” å¯é•¿æœŸç»´æŠ¤
âœ” éšæ—¶å¯æ‰©å±•ä¸ºçœŸå®å·¥å…·åº”ç”¨

â¸»

ä¸‹ä¸€æ­¥ï¼ˆè‡ªç„¶å»¶ä¼¸ï¼‰

ä½ ç°åœ¨å·²ç»æ˜¯**â€œä¸ä¼šèµ°å¼¯è·¯çš„çŠ¶æ€â€**äº†ï¼Œä¸‹ä¸€æ­¥éå¸¸è‡ªç„¶ï¼š

1ï¸âƒ£ ç»™ Log åŠ  Clear / Copy / å¯¼å‡ºï¼ˆRelayCommandï¼‰
2ï¸âƒ£ é¡¶éƒ¨åŠ  Toolbarï¼ˆæ‰“å¼€ Excel / æ‰§è¡Œ / è®¾ç½®ï¼‰
3ï¸âƒ£ ItemA å®è£…çœŸå® Excel æ ¼å¼åŒ–é…ç½®é¡µ

ä½ è¯´åšå“ªä¸€ä¸ªï¼Œæˆ‘å°±åœ¨ è¿™å¥—å·¥ç¨‹ä¸Š ç»§ç»­å¸®ä½ å¾€å‰æ¨è¿›ã€‚